function simulate(a,b,c){var d=[],e={},f=[],g=[];void 0!==a&&a?(f=c,c.forEach(function(a){a.out.forEach(function(a){a.wires.forEach(function(a){g.push({gate:gates[a.inGateIndex]})},this)})})):void 0!==b?(f.push(b),b.out.forEach(function(a){a.wires.forEach(function(a){g.push({gate:gates[a.inGateIndex]})},this)})):(f=inputGates,g=inputQueue),f.forEach(function(a){a.out.forEach(function(b){b.wires.forEach(function(b){b.switch(a.status)},this)})},this),g.forEach(function(a){pushGate(a.gate,d,e)});var h=0;for(console.log(gates);d.length>0;){if(h++>10*gates.length){console.log("Infinite loop detected");break}var i=shiftGate(d,e),j=i.gate;j.inputs=i.inputs,console.log("New gate popped from queue:"),console.log(j),inputWires=[],outputWires=[],void 0!==j.in&&j.in.forEach(function(a){0==a.wires.length?inputWires.push(""):inputWires=inputWires.concat(a.wires)}),void 0!==j.out&&j.out.forEach(function(a){outputWires=outputWires.concat(a.wires)}),inputs=[],inputWires.forEach(function(a){void 0===a.status?inputs.push(0):inputs.push(a.status)});var k=2;try{j.outputNum>0&&(void 0!==j.demux&&j.demux||void 0!==j.mux&&j.mux?k=j.output():1===j.inputNum?k=j.truthTable[j.inputs[0]]:2===j.inputNum&&void 0===j.state?k=j.truthTable[j.inputs[0]][j.inputs[1]]:2===j.inputNum&&void 0!==j.state?(j.switch(),k=j.truthTable):3===j.inputNum&&void 0===j.jk?k=j.truthTable[j.inputs[0]][j.inputs[1]][j.inputs[2]]:void 0!==j.jk?(j.switch(),k=j.truthTable):4===j.inputNum&&(k=j.truthTable[j.inputs[0]][j.inputs[1]][j.inputs[2]][j.inputs[3]]))}catch(a){console.log("Error at gate: "+a),console.log(j)}if("undefiend"==typeof k||void 0==typeof k||null==k)if(1==j.outputNum)k=0;else for(var h=0;h<j.outputNum;h++)k=[],k[h]=0;if("undefined"!=typeof outputWires){var l=[];outputWires.forEach(function(a){(1===j.outputNum&&k!==a.status||j.outputNum>1&&k[a.outIndex]!==a.status)&&(j.outputNum>1?a.status=k[a.outIndex]:a.status=k,a.switch(a.status),l.push(gates[a.inGateIndex]))}),l.forEach(function(a){pushGate(a,d,e)})}0===j.outputNum&&1===j.inputNum&&(j.status=j.inputs[0],j.switch(j.status)),void 0!==j.sevenSeg&&j.switch(inputs)}}function pushGate(a,b,c){var d=[];if(void 0!==a.in)for(var e=0;e<a.inputNum;e++)a.in[e].wires.length>0?(a.inputs[e]=a.in[e].wires[0].status,d[e]=a.in[e].wires[0].status):(a.inputs[e]=0,d[e]=0);var f=getPreviousValues(a),g={gate:a,inputs:d,previousValues:f};b.push(g),c[a.name]=!0}function getPreviousValues(a){var b="",c="",d="";return void 0!==a.previousClk&&(b=a.previousClk),void 0!==a.previousD&&(c=a.previousD),void 0!==a.previousClk&&(d=a.previousReset),{previousClk:b,previousD:c,previoudReset:d}}function setPreviousValues(a,b){void 0!==a.previousClk&&(a.previousClk=b.previousClk),void 0!==a.previousD&&(a.previousD=b.previousD),void 0!==a.previousReset&&(a.previousReset=b.previousReset)}function shiftGate(a,b){if(a.length>0){var c=a.shift();return b[c.name]=!1,c}}function setupClocks(){var a=!1,b=[];clocks.forEach(function(c){c.switch()&&(b.push(c),a=!0)},this),a&&simulate(!0,void 0,b)}function prepareSimulation(){inputQueue=[],inputQueueFlags={},clockInputQueue=[],clockInputQueueFlags={},inputGates=[],clocks=[],gates.forEach(function(a){a.isInSignal&&"undefined"!==gates.out&&(a.out[0].wires.length>0&&(void 0!==a.isClock?clockInputGates.push(a):inputGates.push(a)),a.out.forEach(function(b){b.wires.forEach(function(b){void 0!==a.isClock?pushGate(gates[b.inGateIndex],clockInputQueue,clockInputQueueFlags):pushGate(gates[b.inGateIndex],inputQueue,inputQueueFlags)},this)})),void 0!==a.isClock&&a.out[0].wires.length>0&&clocks.push(a)},this)}function endSimulation(){clearInterval(intervalClock),wires.forEach(function(a){a.switch(2)}),gates.forEach(function(a){void 0!==a.switch&&(a.isInSignal||a.switch(2),void 0!==a.sevenSeg&&a.switch([0,0,0,0,0,0,0]),void 0!==a.counter&&(a.state=0),void 0!==a.jk&&(a.truthTable=[0,0],a.previousJ=0,a.previousClk=0,a.previousK=0))})}function setup(){windowWidth<1260?$("#sidebar").removeClass("fxd"):$("#sidebar").addClass("fxd");var a=document.getElementById("canvas-holder"),b=a.getBoundingClientRect();canWidth=b.right-b.left,canHeigth=canWidth/700*400,canvas=createCanvas(canWidth,canHeigth),canvas.parent("canvas-holder"),canvas.mousePressed(addGateOrWire),pixelDensity(2),smooth(2),$("#AND-GATE").click(function(){0===simToggleValue&&0===deleteWireMode&&(currentGate=new AndGate(0,0))}),$("#OR-GATE").click(function(){0===simToggleValue&&0===deleteWireMode&&(currentGate=new OrGate(0,0))}),$("#CUSTOM-GATE").click(function(){0===simToggleValue&&0===deleteWireMode&&(currentGate=new CustomGate(0,0))}),$("#INPUT-SIGNAL").click(function(){0===simToggleValue&&0===deleteWireMode&&(currentGate=new InSignal(0,0))}),$("#OUTPUT-SIGNAL").click(function(){0===simToggleValue&&0===deleteWireMode&&(currentGate=new OutSignal(0,0))}),$("#MOUSE-POINTER").click(function(){currentGate=null}),$("#CLEAR").click(function(){if(1!==simToggleValue&&!0===confirm("Å½elite li obrisati cijelu skicu?")){for(var a=0;a<gates.length;a++)gates[a].delete();gates=[],wires=[],currentWire=null,currentGate=null,deleteWireMode=0,adjustColor()}}),$("#CLEAR-WIRE").click(function(){clearCurrentWire()}),$("#NOT-GATE").click(function(){0===simToggleValue&&0===deleteWireMode&&(currentGate=new NotGate(0,0))}),$("#NAND-GATE").click(function(){0===simToggleValue&&0===deleteWireMode&&(currentGate=new NandGate(0,0))}),$("#NOR-GATE").click(function(){0===simToggleValue&&0===deleteWireMode&&(currentGate=new NorGate(0,0))}),$("#XOR-GATE").click(function(){0===simToggleValue&&0===deleteWireMode&&(currentGate=new XorGate(0,0))}),$("#DELETE-WIRE-MODE").click(function(){0===simToggleValue&&(deleteWireMode=1-deleteWireMode,adjustColor())}),$("#HALF-ADDER").click(function(){0===simToggleValue&&0===deleteWireMode&&(currentGate=new HalfAdderGate(0,0))}),$("#FULL-ADDER").click(function(){0===simToggleValue&&0===deleteWireMode&&(currentGate=new FullAdderGate(0,0))}),$("#HALF-SUBTRACTOR").click(function(){0===simToggleValue&&0===deleteWireMode&&(currentGate=new HalfSubtractor(0,0))}),$("#FULL-SUBTRACTOR").click(function(){0===simToggleValue&&0===deleteWireMode&&(currentGate=new FullSubtractor(0,0))}),$("#7-SEG-DISPLAY").click(function(){0===simToggleValue&&0===deleteWireMode&&(currentGate=new SevenSegDisplay(0,0))}),$("#BCD-TO-7-SEG").click(function(){0===simToggleValue&&0===deleteWireMode&&(currentGate=new BcdToSevenSeg(0,0))}),$("#COUNTER").click(function(){0===simToggleValue&&0===deleteWireMode&&(deleteWireMode=0,adjustColor(),currentGate=new Counter(0,0))}),$("#SR-LATCH").click(function(){0===simToggleValue&&0===deleteWireMode&&(deleteWireMode=0,adjustColor(),currentGate=new SrLatch(0,0))}),$("#MUX").click(function(){0===simToggleValue&&0===deleteWireMode&&(deleteWireMode=0,adjustColor(),currentGate=new Mux(0,0))}),$("#DEMUX").click(function(){0===simToggleValue&&0===deleteWireMode&&(deleteWireMode=0,adjustColor(),currentGate=new Demux(0,0))}),$("#CLOCK").click(function(){0===simToggleValue&&0===deleteWireMode&&(currentGate=new Clock(0,0))}),$("#D-FLIP-FLOP").click(function(){0===simToggleValue&&0===deleteWireMode&&(currentGate=new DFlipFlop(0,0))}),$("#T-FLIP-FLOP").click(function(){0===simToggleValue&&0===deleteWireMode&&(currentGate=new TFlipFlop(0,0))}),$("#JK-FLIP-FLOP").click(function(){0===simToggleValue&&0===deleteWireMode&&(currentGate=new JkFlipFlop(0,0))}),$("#SIMULATION").click(function(){deleteWireMode=0,adjustColor(),currentGate=null,currentWire=null,simToggleValue=1-simToggleValue,1===simToggleValue?($("#SIMULATION").removeClass("btn-danger"),$("#SIMULATION").addClass("btn-success"),$("#SIMULATION").html("<span class='glyphicon glyphicon-stop'></span>&nbsp;Zaustavi"),prepareSimulation(),simulate(),intervalClock=setInterval(clock,5)):($("#SIMULATION").removeClass("btn-success"),$("#SIMULATION").addClass("btn-danger"),$("#SIMULATION").html("<span class='glyphicon glyphicon-play'></span>&nbsp;Pokreni"),endSimulation())})}function clock(){1===simToggleValue&&setupClocks()}function draw(){scroll=$(document).scrollTop(),background("#F8F8F8");for(var a=gates.length-1;a>=0;a--)1==gates[a].closeButton.value()?gates[a].draw():(gates[a].delete(),gates.splice(a,1),refreshGates());for(a=0;a<wires.length;a++)wires[a].draw();null!==currentGate&&0===simToggleValue?displayGate():null!==currentWire&&(currentWire.draw(),currentWire.drawSegment()),drawFrame(),1===deleteWireMode&&drawEraser()}function drawEraser(){line(mouseX,mouseY,mouseX-10,mouseY-10),line(mouseX,mouseY,mouseX+5,mouseY-5),line(mouseX+5,mouseY-5,mouseX-5,mouseY-15),line(mouseX-5,mouseY-15,mouseX-10,mouseY-10),line(mouseX-10,mouseY-10,mouseX-10+10,mouseY-10-20),line(mouseX-5,mouseY-15,mouseX-5+10,mouseY-15-20),line(mouseX+5,mouseY-5,mouseX+5+10,mouseY-5-20),line(mouseX-5+10,mouseY-15-20,mouseX-10+10,mouseY-10-20),line(mouseX-5+10,mouseY-15-20,mouseX+5+10,mouseY-5-20)}function drawFrame(){noFill(),stroke(0),strokeWeight(2),rect(1,1,width-2,height-2),strokeWeight(1)}function adjustColor(){1===deleteWireMode?(clearCurrentWire(),$("#DELETE-WIRE-MODE").removeClass("btn-warning"),$("#DELETE-WIRE-MODE").addClass("btn-success")):($("#DELETE-WIRE-MODE").removeClass("btn-success"),$("#DELETE-WIRE-MODE").addClass("btn-warning"))}function windowResized(){windowWidth<1260?$("#sidebar").removeClass("fxd"):$("#sidebar").addClass("fxd");for(var a=document.getElementById("canvas-holder"),b=a.getBoundingClientRect(),c=b.right-b.left,d=c/700*400,e=0,f=0,g=0;g<gates.length;g++)e<gates[g].right&&(e=gates[g].right),f<gates[g].bottom&&(f=gates[g].bottom);for(var g=0;g<wires.length;g++)for(var h=0;h<wires[g].points.length;h++)e<wires[g].points[h].x&&(e=wires[g].points[h].x),f<wires[g].points[h].y&&(f=wires[g].points[h].y);c>e&&d>f&&(canWidth=c,canHeigth=d),canvas.size(canWidth,canHeigth);for(var g=0;g<gates.length;g++)gates[g].refreshButtons()}function addGateOrWire(){if(gateCreated=!1,1!==simToggleValue)if(null!==currentGate){if(outOfBounds(currentGate))return;var a=placeTaken();if(a)return;currentGate.set(),gates.push(currentGate),currentGate=currentGate.clone(),gateCreated=!0}else null!==currentWire&&currentWire.addPath()}function displayGate(){if(currentGate.refreshPosition(),outOfBounds(currentGate))return stroke(255,10,20),currentGate.draw(),void stroke(0);placeTaken()?(stroke(255,10,20),currentGate.draw(),stroke(0)):currentGate.draw()}function clearCurrentGate(){if(null!==currentGate){if(gateCreated){var a=gates.length-1;gates[a].delete(),gates.splice(a,1),refreshGates(),gateCreated=!1}currentGate=null}}function placeTaken(){var a=!1;for(i=0;i<gates.length;i++)if(gates[i].placeTaken(currentGate)){a=!0;break}if(!a)for(i=0;i<wires.length;i++)if(wires[i].placeTaken(currentGate)){a=!0;break}return a}function outOfBounds(a){return a.left<3||a.right>width-3||a.up<0||a.bottom>height}function refreshGates(){for(var a=0;a<gates.length;a++)gates[a].refresh(a)}function refreshWires(){for(i=0;i<wires.length;i++)wires[i].refresh(i)}function deleteWire(a){for(var b=gates[a.inGateIndex].in[a.inIndex],c=0;c<b.wires.length;c++)if(b.wires[c]===a){b.wires.splice(c,1);break}for(var b=gates[a.outGateIndex].out[a.outIndex],c=0;c<b.wires.length;c++)if(b.wires[c]===a){b.wires.splice(c,1);break}for(var d=0;d<wires.length;d++)if(wires[d]===a){wires.splice(d,1);break}}function clearCurrentWire(){if(0===simToggleValue&&null!==currentWire){if(null!==currentWire.inGateIndex){var a=gates[currentWire.inGateIndex].in[currentWire.inIndex].wires;if(a.length>0){var b=a[a.length-1];(null!==b&&null===b.outGateIndex||null===b.inGateIndex)&&a.splice(a.length-1,1)}}else{var c=gates[currentWire.outGateIndex].out[currentWire.outIndex].wires;if(c.length>0){var b=c[c.length-1];(null!==b&&null===b.outGateIndex||null===b.inGateIndex)&&c.splice(c.length-1,1)}}currentWire=null}}function Wire(){this.points=[],this.segment=[],this.inGateIndex=null,this.inIndex=null,this.outGateIndex=null,this.outIndex=null,this.branchButton=new BranchButton(this),this.done=!1,this.index,this.status=2,this.color=color(0),this.branchingPoint=null,this.branchedFrom=null,this.branchIndexBefore=null,this.bSet=!1,this.drawSegment=function(){this.segment=[],this.add(null),strokeWeight(2),stroke(150);for(var a=1;a<this.segment.length;a++)line(this.segment[a-1].x,this.segment[a-1].y,this.segment[a].x,this.segment[a].y);if(stroke(0),null!==this.branchingPoint&&!1===this.bSet){var b=this.segment[1],c=wires[this.branchedFrom].points[this.branchIndexBefore].y,d=wires[this.branchedFrom].points[this.branchIndexBefore+1].y;wires[this.branchedFrom].points[this.branchIndexBefore+1].x;b.y<min(c,d)?this.branchingPoint.y=min(c,d):b.y>max(c,d)?this.branchingPoint.y=max(c,d):this.branchingPoint.y=b.y}strokeWeight(1)},this.addPath=function(){this.branchedX=!1,this.bSet=!0;for(var a=1;a<this.segment.length;a++)this.points.push(this.segment[a]);this.segment=[]},this.addIn=function(a,b){this.inGateIndex=Number(a),this.inIndex=parseInt(b);var c=gates[this.inGateIndex].in[b];0===this.points.length?this.points.push(new Point(c.x,c.y)):this.add(c)},this.addOut=function(a,b){this.outGateIndex=Number(a),this.outIndex=parseInt(b);var c=gates[this.outGateIndex].out[b];0===this.points.length?this.points.push(new Point(c.x,c.y)):this.add(c)},this.add=function(a){var b=this.points[this.points.length-1];null!==a?(this.points.push(new Point(b.x,a.y)),this.points.push(new Point(a.x,a.y))):(this.segment.push(b),this.segment.push(new Point(b.x,mouseY)),this.segment.push(new Point(mouseX,mouseY)))},this.draw=function(){!1===this.done&&null!==this.inGateIndex&&null!==this.outGateIndex&&(this.done=!0),this.mouseOver(),stroke(this.color),strokeWeight(2);for(var a=1;a<this.points.length;a++)line(this.points[a-1].x,this.points[a-1].y,this.points[a].x,this.points[a].y);strokeWeight(1),stroke(0),null!==this.branchingPoint&&(fill(0),ellipse(this.branchingPoint.x,this.branchingPoint.y,5,5),noFill()),this.mouseOver()},this.mouseOver=function(){this.points[0],this.points[this.points.length-1];if(!this.done||null!==currentGate||1===simToggleValue)return void this.branchButton.hide();for(var c=1;c<this.points.length;c++)if(this.points[c-1].x==this.points[c].x){var d=this.points[c-1].x,e=this.points[c-1].y,f=this.points[c].y;if(mouseX>d-5&&mouseX<d+5&&mouseY>=min(e,f)&&mouseY<=max(e,f))return this.branchButton.setPosition(d,mouseY),this.branchButton.setPointBeforeIndex(c-1),void this.branchButton.show()}else if(this.points[c-1].y==this.points[c].y){var g=this.points[c-1].y,h=this.points[c-1].x,i=this.points[c].x;if(mouseY>g-5&&mouseY<g+5&&mouseX>=min(h,i)&&mouseX<=max(h,i))return this.branchButton.setPosition(mouseX,g),this.branchButton.setPointBeforeIndex(c-1),void this.branchButton.show()}this.branchButton.hide()},this.push=function(){this.index=wires.length,this.branchButton.setIndex(),wires.push(this),currentWire=null},this.refresh=function(a){this.index=a,this.branchButton.setIndex()},this.placeTaken=function(a){for(var b=1;b<this.points.length;b++){var c=min(this.points[b-1].x,this.points[b].x)-9,d=max(this.points[b-1].x,this.points[b].x)+9,e=min(this.points[b-1].y,this.points[b].y)-9,f=max(this.points[b-1].y,this.points[b].y)+9;if(a.left<d&&a.right>c&&a.up<f&&a.bottom>e)return!0}return!1},this.switch=function(a){this.status=a,2===this.status?this.color=color(0):1===this.status?this.color=color(0,255,0):0===this.status&&(this.color=color(255,0,0))}}function Point(a,b){this.x=a,this.y=b}function CustomGate(a,b){this.x=a,this.y=b,this.index=-1,this.name="CUSTOM_GATE_",this.length=75,this.height=150,this.left=this.x-20,this.right=this.x+this.length+20,this.up=this.y,this.bottom=this.y+this.height,this.closeButton=new CloseButton(this),this.inputNum=4,this.outputNum=3,this.in=[],this.out=[],this.isInSignal=!1,this.isOutSignal=!1,this.draw=function(){if(noFill(),strokeWeight(2),rect(this.x,this.y,this.length,this.height),2==this.inputNum)line(this.left,this.y+this.height/4,this.x,this.y+this.height/4),line(this.left,this.y+3*this.height/4,this.x,this.y+3*this.height/4);else for(var a=0;a<this.inputNum;a++)line(this.left,this.y+(a+1)*this.height/(this.inputNum+1),this.x,this.y+(a+1)*this.height/(this.inputNum+1));for(a=0;a<this.outputNum;a++)line(this.x+this.length,this.y+(a+1)*this.height/(this.outputNum+1),this.right,this.y+(a+1)*this.height/(this.outputNum+1));for(strokeWeight(1),this.index>=0&&this.mouseInside()&&null===currentGate&&0===simToggleValue&&null===currentWire?this.closeButton.show():this.closeButton.hide(),a=0;a<this.out.length;a++){var b=this.out[a];mouseX>b.x-10&&mouseX<b.x+10&&mouseY>b.y-10&&mouseY<b.y+10&&0===simToggleValue&&null===currentGate&&0===b.wires.length?b.show():b.hide()}for(a=0;a<this.in.length;a++){var b=this.in[a];mouseX>b.x-10&&mouseX<b.x+10&&mouseY>b.y-10&&mouseY<b.y+10&&0===simToggleValue&&null===currentGate&&0===b.wires.length?b.show():b.hide()}},this.placeTaken=function(a){return a.left<this.right+10&&a.right>this.left-10&&a.up<this.bottom&&a.bottom>this.up},this.clone=function(){return new CustomGate},this.mouseInside=function(){return mouseX>this.left-6&&mouseX<this.right+6&&mouseY>this.up&&mouseY<this.bottom},this.set=function(){for(this.refreshPosition(),this.index=gates.length,this.name+=this.index,i=0;i<this.inputNum;i++)this.in[i]=new InButton(this,i);for(i=0;i<this.outputNum;i++)this.out[i]=new OutButton(this,i);this.refreshButtons()},this.refreshButtons=function(){if(2==this.inputNum)this.in[0].setPosition(this.left,this.y+this.height/4),this.in[1].setPosition(this.left,this.y+3*this.height/4);else for(i=0;i<this.inputNum;i++)this.in[i].setPosition(this.left,this.y+(i+1)*this.height/(this.inputNum+1));for(i=0;i<this.outputNum;i++)this.out[i].setPosition(this.right,this.y+(i+1)*this.height/(this.outputNum+1));this.closeButton.setPosition(this.right-20,this.up)},this.delete=function(){for(var a=0;a<this.inputNum;a++)this.in[a].hide();for(a=0;a<this.outputNum;a++)this.out[a].hide();for(this.closeButton.hide(),a=wires.length-1;a>=0;a--)wires[a].inGateIndex!=this.index&&wires[a].outGateIndex!=this.index||deleteWire(wires[a]);refreshWires()},this.refreshPosition=function(){this.x=mouseX,this.y=mouseY-mouseY%5,this.left=this.x-20,this.right=this.x+this.length+20,this.up=this.y,this.bottom=this.y+this.height},this.refresh=function(a){if(this.index!=a){var b=this.index;this.index=a,this.name="CUSTOM_GATE_"+this.index;for(var c=0;c<wires.length;c++)wires[c].inGateIndex==b&&(wires[c].inGateIndex=a),wires[c].outGateIndex==b&&(wires[c].outGateIndex=a);for(c=0;c<this.in.length;c++)this.in[c].refresh();for(c=0;c<this.out.length;c++)this.out[c].refresh()}}}function Demux(a,b){this.x=a,this.y=b,this.index=-1,this.name="DEMUX_",this.length=40,this.height=80,this.left=this.x-22,this.right=this.x+this.length+22,this.up=this.y,this.bottom=this.y+this.height+10,this.closeButton=new CloseButton(this),this.inputNum=3,this.outputNum=4,this.in=[],this.out=[],this.isInSignal=!1,this.isOutSignal=!1,this.mux=!0,this.demux=!0,this.truthTable=[],this.inputs=[0,0,0],this.draw=function(){noFill(),strokeWeight(2),line(this.x,this.y+20,this.x+this.length,this.y),line(this.x,this.y+this.height-20,this.x+this.length,this.y+this.height),line(this.x,this.y+20,this.x,this.y+this.height-20),line(this.x+this.length,this.y,this.x+this.length,this.y+this.height),line(this.left,this.y+40,this.x,this.y+40),line(this.x+30,this.y+this.height-5,this.x+30,this.y+this.height+15),line(this.x+10,this.y+this.height-14,this.x+10,this.y+this.height+15);for(var a=0;a<this.outputNum;a++)line(this.x+this.length,this.y+10+20*a,this.right,this.y+10+20*a);for(strokeWeight(.7),textSize(9),text("I0",this.right-18,this.y+8),text("I1",this.right-18,this.y+28),text("I2",this.right-18,this.y+48),text("I3",this.right-18,this.y+68),text("S1",this.x-3,this.y+this.height+10),text("S0",this.x+17,this.y+this.height+10),strokeWeight(1),textSize(10),text("DEMUX",this.x+2,this.y+36),textSize(12),text("1/4",this.x+10,this.y+52),strokeWeight(1),this.index>=0&&this.mouseInside()&&null===currentGate&&0===simToggleValue&&null===currentWire?this.closeButton.show():this.closeButton.hide(),a=0;a<this.out.length;a++){var b=this.out[a];mouseX>b.x-10&&mouseX<b.x+10&&mouseY>b.y-10&&mouseY<b.y+10&&0===simToggleValue&&null===currentGate&&0===b.wires.length?b.show():b.hide()}for(a=0;a<this.in.length;a++){var b=this.in[a];mouseX>b.x-6&&mouseX<b.x+6&&mouseY>b.y-6&&mouseY<b.y+6&&0===simToggleValue&&null===currentGate&&0===b.wires.length?b.show():b.hide()}},this.placeTaken=function(a){return a.left<this.right&&a.right>this.left&&a.up<this.bottom&&a.bottom>this.up},this.clone=function(){return new Demux},this.mouseInside=function(){return mouseX>this.left-6&&mouseX<this.right+6&&mouseY>this.up&&mouseY<this.bottom},this.set=function(){this.refreshPosition(),this.index=gates.length,this.name+=this.index;for(var a=0;a<this.inputNum;a++)this.in[a]=new InButton(this,a);for(a=0;a<this.outputNum;a++)this.out[a]=new OutButton(this,a);this.refreshButtons()},this.refreshButtons=function(){this.in[0].setPosition(this.left,this.y+40),this.in[1].setPosition(this.x+10,this.y+this.height+15),this.in[2].setPosition(this.x+30,this.y+this.height+15);for(var a=0;a<this.outputNum;a++)this.out[a].setPosition(this.right,this.y+10+20*a);this.closeButton.setPosition(this.right-33,this.up+2)},this.delete=function(){for(var a=0;a<this.inputNum;a++)this.in[a].hide();this.closeButton.hide();for(var a=wires.length-1;a>=0;a--)wires[a].inGateIndex!=this.index&&wires[a].outGateIndex!=this.index||deleteWire(wires[a]);refreshWires()},this.refreshPosition=function(){this.x=mouseX,this.y=mouseY-mouseY%5,this.left=this.x-22,this.right=this.x+this.length+22,this.up=this.y,this.bottom=this.y+this.height+15},this.refresh=function(a){if(this.index!=a){var b=this.index;this.index=a,this.name="DEMUX_"+this.index;for(var c=0;c<wires.length;c++)wires[c].inGateIndex==b&&(wires[c].inGateIndex=a),wires[c].outGateIndex==b&&(wires[c].outGateIndex=a);for(var c=0;c<this.in.length;c++)this.in[c].refresh();for(var c=0;c<this.out.length;c++)this.out[c].refresh()}},this.output=function(){var a=this.inputs[0],b=[[[a,0,0,0],[0,a,0,0]],[[0,0,a,0],[0,0,0,a]]];if(2===this.inputs[1]||2===this.inputs[2])return 2;var c=b[this.inputs[1]][this.inputs[2]];return void 0===c?2:c}}function DFlipFlop(a,b){this.x=a,this.y=b,this.index=-1,this.name="D_FLIP_FLOP_",this.length=40,this.height=60,this.left=this.x-20,this.right=this.x+this.length+20,this.up=this.y,this.bottom=this.y+this.height,this.closeButton=new CloseButton(this),this.inputNum=2,this.outputNum=2,this.in=[],this.out=[],this.isInSignal=!1,this.isOutSignal=!1,this.truthTable=[0,1],this.state=!0,this.previousD=0,this.previousClk=0,this.inputs=[0,0],this.draw=function(){for(noFill(),strokeWeight(2),line(this.x,this.y,this.x+this.length,this.y),line(this.x,this.y+this.height,this.x+this.length,this.y+this.height),line(this.x,this.y,this.x,this.y+this.height),line(this.x+this.length,this.y,this.x+this.length,this.y+this.height),2==this.inputNum&&(line(this.left,this.y+this.height/4,this.x,this.y+this.height/4),line(this.left,this.y+3*this.height/4,this.x,this.y+3*this.height/4)),line(this.x+this.length,this.y+this.height/4,this.x+this.length+20,this.y+this.height/4),line(this.x+this.length,this.y+3*this.height/4,this.x+this.length+20,this.y+3*this.height/4),strokeWeight(1.2),textSize(14),text("D",this.x+15,this.y+35),strokeWeight(.7),textSize(10),text("D",this.x-10,this.y+12),text("E",this.x-10,this.y+42),text("Q",this.x+44,this.y+12),text("Q",this.x+44,this.y+42),strokeWeight(1),line(this.x+this.length+4,this.y+this.height-28,this.x+this.length+11,this.y+this.height-28),this.index>=0&&this.mouseInside()&&null===currentGate&&0===simToggleValue&&null===currentWire?this.closeButton.show():this.closeButton.hide(),i=0;i<this.out.length;i++){var a=this.out[i];mouseX>a.x-10&&mouseX<a.x+10&&mouseY>a.y-10&&mouseY<a.y+10&&0===simToggleValue&&null===currentGate&&0===a.wires.length?a.show():a.hide()}for(i=0;i<this.in.length;i++){var a=this.in[i];mouseX>a.x-10&&mouseX<a.x+10&&mouseY>a.y-10&&mouseY<a.y+10&&0===simToggleValue&&null===currentGate&&0===a.wires.length?a.show():a.hide()}},this.placeTaken=function(a){return a.left<this.right+10&&a.right>this.left-10&&a.up<this.bottom&&a.bottom>this.up},this.clone=function(){return new DFlipFlop},this.mouseInside=function(){return mouseX>this.left-6&&mouseX<this.right+6&&mouseY>this.up&&mouseY<this.bottom},this.set=function(){this.x=mouseX,this.y=mouseY-mouseY%5,this.index=gates.length,this.name+=this.index;for(var a=0;a<this.inputNum;a++)this.in[a]=new InButton(this,a);for(a=0;a<this.outputNum;a++)this.out[a]=new OutButton(this,a);this.refreshButtons(),this.truthTable=[0,1]},this.refreshButtons=function(){this.in[0].setPosition(this.left,this.y+this.height/4),this.in[1].setPosition(this.left,this.y+3*this.height/4),this.out[0].setPosition(this.right,this.y+this.height/4),this.out[1].setPosition(this.right,this.y+3*this.height/4),this.closeButton.setPosition(this.right-33,this.up+2)},this.delete=function(){for(var a=0;a<this.inputNum;a++)this.in[a].hide();for(a=0;a<this.outputNum;a++)this.out[a].hide();for(this.closeButton.hide(),a=wires.length-1;a>=0;a--)wires[a].inGateIndex!=this.index&&wires[a].outGateIndex!=this.index||deleteWire(wires[a]);refreshWires()},this.refreshPosition=function(){this.x=mouseX,this.y=mouseY-mouseY%5,this.left=this.x-22,this.right=this.x+this.length+22,this.up=this.y,this.bottom=this.y+this.height},this.refresh=function(a){if(this.index!=a){var b=this.index;this.index=a,this.name="D_FLIP_FLOP"+this.index;for(var c=0;c<wires.length;c++)wires[c].inGateIndex==b&&(wires[c].inGateIndex=a),wires[c].outGateIndex==b&&(wires[c].outGateIndex=a);for(c=0;c<this.in.length;c++)this.in[c].refresh();for(c=0;c<this.out.length;c++)this.out[c].refresh()}},this.switch=function(){var a=this.inputs[0],b=this.inputs[1];0===this.truthTable[0]&&1===this.truthTable[1]?0===a||1===b&&0!==this.previousD&&(this.truthTable=[1,0]):1===this.truthTable[0]&&0===this.truthTable[1]&&(1===a||1===b&&1!==this.previousClk&&(this.truthTable=[0,1])),this.previousClk=b,this.previousD=a}}function FullAdderGate(a,b){this.x=a,this.y=b,this.index=-1,this.name="FULL_ADDER_GATE_",this.length=40,this.height=60,this.left=this.x-20,this.right=this.x+this.length+20,this.up=this.y,this.bottom=this.y+this.height,this.closeButton=new CloseButton(this),this.inputNum=3,this.outputNum=2,this.in=[],this.out=[],this.isInSignal=!1,this.isOutSignal=!1,this.truthTable=[],this.inputs=[0,0,0],this.draw=function(){for(noFill(),strokeWeight(2),line(this.x,this.y,this.x+this.length,this.y),line(this.x,this.y+this.height,this.x+this.length,this.y+this.height),line(this.x,this.y,this.x,this.y+this.height),line(this.x+this.length,this.y,this.x+this.length,this.y+this.height),3==this.inputNum&&(line(this.left,this.y+this.height/4-5,this.x,this.y+this.height/4-5),line(this.left,this.y+2*this.height/4,this.x,this.y+2*this.height/4),line(this.left,this.y+3*this.height/4+5,this.x,this.y+3*this.height/4+5)),line(this.x+this.length,this.y+this.height/4-5,this.x+this.length+20,this.y+this.height/4-5),line(this.x+this.length,this.y+3*this.height/4+5,this.x+this.length+20,this.y+3*this.height/4+5),strokeWeight(1.2),textSize(14),text("F A",this.x+9,this.y+35),strokeWeight(.7),textSize(10),text("A",this.x-10,this.y+8),text("B",this.x-10,this.y+28),text("Ci",this.x-12,this.y+48),text("S",this.x+44,this.y+8),text("Co",this.x+44,this.y+48),strokeWeight(1),this.index>=0&&this.mouseInside()&&null===currentGate&&0===simToggleValue&&null===currentWire?this.closeButton.show():this.closeButton.hide(),i=0;i<this.out.length;i++){var a=this.out[i];mouseX>a.x-10&&mouseX<a.x+10&&mouseY>a.y-10&&mouseY<a.y+10&&0===simToggleValue&&null===currentGate&&0===a.wires.length?a.show():a.hide()}for(i=0;i<this.in.length;i++){var a=this.in[i];mouseX>a.x-10&&mouseX<a.x+10&&mouseY>a.y-10&&mouseY<a.y+10&&0===simToggleValue&&null===currentGate&&0===a.wires.length?a.show():a.hide()}},this.placeTaken=function(a){return a.left<this.right+10&&a.right>this.left-10&&a.up<this.bottom&&a.bottom>this.up},this.clone=function(){return new FullAdderGate},this.mouseInside=function(){return mouseX>this.left-6&&mouseX<this.right+6&&mouseY>this.up&&mouseY<this.bottom},this.set=function(){if(this.refreshPosition(),this.index=gates.length,this.name+=this.index,3==this.inputNum)for(var a=0;a<this.inputNum;a++)this.in[a]=new InButton(this,a);for(a=0;a<this.outputNum;a++)this.out[a]=new OutButton(this,a);this.refreshButtons(),this.truthTable=[[[[0,0],[1,0]],[[1,0],[0,1]]],[[[1,0],[0,1]],[[0,1],[1,1]]]]},this.refreshButtons=function(){3==this.inputNum&&(this.in[0].setPosition(this.left,this.y+this.height/4-5),this.in[1].setPosition(this.left,this.y+2*this.height/4),this.in[2].setPosition(this.left,this.y+3*this.height/4+5)),this.out[0].setPosition(this.right,this.y+this.height/4-5),this.out[1].setPosition(this.right,this.y+3*this.height/4+5),this.closeButton.setPosition(this.right-33,this.up+2)},this.delete=function(){for(var a=0;a<this.inputNum;a++)this.in[a].hide();for(a=0;a<this.outputNum;a++)this.out[a].hide();for(this.closeButton.hide(),a=wires.length-1;a>=0;a--)wires[a].inGateIndex!=this.index&&wires[a].outGateIndex!=this.index||deleteWire(wires[a]);refreshWires()},this.refreshPosition=function(){this.x=mouseX,this.y=mouseY-mouseY%5,this.left=this.x-22,this.right=this.x+this.length+22,this.up=this.y,this.bottom=this.y+this.height},this.refresh=function(a){if(this.index!=a){var b=this.index;this.index=a,this.name="FULL_ADDER_GATE_"+this.index;for(var c=0;c<wires.length;c++)wires[c].inGateIndex==b&&(wires[c].inGateIndex=a),wires[c].outGateIndex==b&&(wires[c].outGateIndex=a);for(c=0;c<this.in.length;c++)this.in[c].refresh();for(c=0;c<this.out.length;c++)this.out[c].refresh()}}}function FullSubtractor(a,b){this.x=a,this.y=b,this.index=-1,this.name="FULL_SUBTRACTOR_",this.length=40,this.height=60,this.left=this.x-20,this.right=this.x+this.length+20,this.up=this.y,this.bottom=this.y+this.height,this.closeButton=new CloseButton(this),this.inputNum=3,this.outputNum=2,this.in=[],this.out=[],this.isInSignal=!1,this.isOutSignal=!1,this.truthTable=[],this.inputs=[0,0,0],this.draw=function(){for(noFill(),strokeWeight(2),line(this.x,this.y,this.x+this.length,this.y),line(this.x,this.y+this.height,this.x+this.length,this.y+this.height),line(this.x,this.y,this.x,this.y+this.height),line(this.x+this.length,this.y,this.x+this.length,this.y+this.height),3==this.inputNum&&(line(this.left,this.y+this.height/4-5,this.x,this.y+this.height/4-5),line(this.left,this.y+2*this.height/4,this.x,this.y+2*this.height/4),line(this.left,this.y+3*this.height/4+5,this.x,this.y+3*this.height/4+5)),line(this.x+this.length,this.y+this.height/4-5,this.x+this.length+20,this.y+this.height/4-5),line(this.x+this.length,this.y+3*this.height/4+5,this.x+this.length+20,this.y+3*this.height/4+5),strokeWeight(1.2),textSize(14),text("F S",this.x+9,this.y+35),strokeWeight(.7),textSize(10),text("A",this.x-10,this.y+8),text("B",this.x-10,this.y+28),text("Ci",this.x-12,this.y+48),text("S",this.x+44,this.y+8),text("Co",this.x+44,this.y+48),strokeWeight(1),this.index>=0&&this.mouseInside()&&null===currentGate&&0===simToggleValue&&null===currentWire?this.closeButton.show():this.closeButton.hide(),i=0;i<this.out.length;i++){var a=this.out[i];mouseX>a.x-10&&mouseX<a.x+10&&mouseY>a.y-10&&mouseY<a.y+10&&0===simToggleValue&&null===currentGate&&0===a.wires.length?a.show():a.hide()}for(i=0;i<this.in.length;i++){var a=this.in[i];mouseX>a.x-10&&mouseX<a.x+10&&mouseY>a.y-10&&mouseY<a.y+10&&0===simToggleValue&&null===currentGate&&0===a.wires.length?a.show():a.hide()}},this.placeTaken=function(a){return a.left<this.right+10&&a.right>this.left-10&&a.up<this.bottom&&a.bottom>this.up},this.clone=function(){return new FullSubtractor},this.mouseInside=function(){return mouseX>this.left-6&&mouseX<this.right+6&&mouseY>this.up&&mouseY<this.bottom},this.set=function(){if(this.refreshPosition(),this.index=gates.length,this.name+=this.index,3==this.inputNum)for(var a=0;a<this.inputNum;a++)this.in[a]=new InButton(this,a);for(a=0;a<this.outputNum;a++)this.out[a]=new OutButton(this,a);this.refreshButtons(),this.truthTable=[[[[0,0],[1,1]],[[1,1],[0,1]]],[[[1,0],[0,0]],[[0,0],[1,1]]]]},this.refreshButtons=function(){3==this.inputNum&&(this.in[0].setPosition(this.left,this.y+this.height/4-5),this.in[1].setPosition(this.left,this.y+2*this.height/4),this.in[2].setPosition(this.left,this.y+3*this.height/4+5)),this.out[0].setPosition(this.right,this.y+this.height/4-5),this.out[1].setPosition(this.right,this.y+3*this.height/4+5),this.closeButton.setPosition(this.right-33,this.up+2)},this.delete=function(){for(var a=0;a<this.inputNum;a++)this.in[a].hide();for(a=0;a<this.outputNum;a++)this.out[a].hide();for(this.closeButton.hide(),a=wires.length-1;a>=0;a--)wires[a].inGateIndex!=this.index&&wires[a].outGateIndex!=this.index||deleteWire(wires[a]);refreshWires()},this.refreshPosition=function(){this.x=mouseX,this.y=mouseY-mouseY%5,this.left=this.x-22,this.right=this.x+this.length+22,this.up=this.y,this.bottom=this.y+this.height},this.refresh=function(a){if(this.index!=a){var b=this.index;this.index=a,this.name="FULL_SUBTRACTOR_"+this.index;for(var c=0;c<wires.length;c++)wires[c].inGateIndex==b&&(wires[c].inGateIndex=a),wires[c].outGateIndex==b&&(wires[c].outGateIndex=a);for(c=0;c<this.in.length;c++)this.in[c].refresh();for(c=0;c<this.out.length;c++)this.out[c].refresh()}}}function HalfAdderGate(a,b){this.x=a,this.y=b,this.index=-1,this.name="HALF_ADDER_GATE_",this.length=40,this.height=60,this.left=this.x-20,this.right=this.x+this.length+20,this.up=this.y,this.bottom=this.y+this.height,this.closeButton=new CloseButton(this),this.inputNum=2,this.outputNum=2,this.in=[],this.out=[],this.isInSignal=!1,this.isOutSignal=!1,this.truthTable=[],this.inputs=[0,0,0],this.draw=function(){for(noFill(),strokeWeight(2),line(this.x,this.y,this.x+this.length,this.y),line(this.x,this.y+this.height,this.x+this.length,this.y+this.height),line(this.x,this.y,this.x,this.y+this.height),line(this.x+this.length,this.y,this.x+this.length,this.y+this.height),2==this.inputNum&&(line(this.left,this.y+this.height/4,this.x,this.y+this.height/4),line(this.left,this.y+3*this.height/4,this.x,this.y+3*this.height/4)),line(this.x+this.length,this.y+this.height/4,this.x+this.length+20,this.y+this.height/4),line(this.x+this.length,this.y+3*this.height/4,this.x+this.length+20,this.y+3*this.height/4),strokeWeight(1.2),textSize(14),text("H A",this.x+9,this.y+35),strokeWeight(.7),textSize(10),text("A",this.x-10,this.y+12),text("B",this.x-10,this.y+42),text("S",this.x+44,this.y+12),text("C",this.x+44,this.y+42),strokeWeight(1),this.index>=0&&this.mouseInside()&&null===currentGate&&0===simToggleValue&&null===currentWire?this.closeButton.show():this.closeButton.hide(),i=0;i<this.out.length;i++){var a=this.out[i];mouseX>a.x-10&&mouseX<a.x+10&&mouseY>a.y-10&&mouseY<a.y+10&&0===simToggleValue&&null===currentGate&&0===a.wires.length?a.show():a.hide()}for(i=0;i<this.in.length;i++){var a=this.in[i];mouseX>a.x-10&&mouseX<a.x+10&&mouseY>a.y-10&&mouseY<a.y+10&&0===simToggleValue&&null===currentGate&&0===a.wires.length?a.show():a.hide()}},this.placeTaken=function(a){return a.left<this.right+10&&a.right>this.left-10&&a.up<this.bottom&&a.bottom>this.up},this.clone=function(){return new HalfAdderGate},this.mouseInside=function(){return mouseX>this.left-6&&mouseX<this.right+6&&mouseY>this.up&&mouseY<this.bottom},this.set=function(){if(this.refreshPosition(),this.index=gates.length,this.name+=this.index,2==this.inputNum)for(var a=0;a<this.inputNum;a++)this.in[a]=new InButton(this,a);for(a=0;a<this.outputNum;a++)this.out[a]=new OutButton(this,a);this.refreshButtons(),this.truthTable=[[[0,0],[1,0],[2,2]],[[1,0],[0,1],[2,2]],[[2,2],[2,2],[2,2]]]},this.refreshButtons=function(){2==this.inputNum&&(this.in[0].setPosition(this.left,this.y+this.height/4),this.in[1].setPosition(this.left,this.y+3*this.height/4)),this.out[0].setPosition(this.right,this.y+this.height/4),this.out[1].setPosition(this.right,this.y+3*this.height/4),this.closeButton.setPosition(this.right-33,this.up+2)},this.delete=function(){for(var a=0;a<this.inputNum;a++)this.in[a].hide();for(a=0;a<this.outputNum;a++)this.out[a].hide();for(this.closeButton.hide(),a=wires.length-1;a>=0;a--)wires[a].inGateIndex!=this.index&&wires[a].outGateIndex!=this.index||deleteWire(wires[a]);refreshWires()},this.refreshPosition=function(){this.x=mouseX,this.y=mouseY-mouseY%5,this.left=this.x-22,this.right=this.x+this.length+22,this.up=this.y,this.bottom=this.y+this.height},this.refresh=function(a){if(this.index!=a){var b=this.index;this.index=a,this.name="HALF_ADDER_GATE_"+this.index;for(var c=0;c<wires.length;c++)wires[c].inGateIndex==b&&(wires[c].inGateIndex=a),wires[c].outGateIndex==b&&(wires[c].outGateIndex=a);for(c=0;c<this.in.length;c++)this.in[c].refresh();for(c=0;c<this.out.length;c++)this.out[c].refresh()}}}function HalfSubtractor(a,b){this.x=a,this.y=b,this.index=-1,this.name="HALF_SUBTRACTOR_",this.length=40,this.height=60,this.left=this.x-20,this.right=this.x+this.length+20,this.up=this.y,this.bottom=this.y+this.height,this.closeButton=new CloseButton(this),this.inputNum=2,this.outputNum=2,this.in=[],this.out=[],this.isInSignal=!1,this.isOutSignal=!1,this.truthTable=[],this.inputs=[0,0,0],this.draw=function(){for(noFill(),strokeWeight(2),line(this.x,this.y,this.x+this.length,this.y),line(this.x,this.y+this.height,this.x+this.length,this.y+this.height),line(this.x,this.y,this.x,this.y+this.height),line(this.x+this.length,this.y,this.x+this.length,this.y+this.height),2==this.inputNum&&(line(this.left,this.y+this.height/4,this.x,this.y+this.height/4),line(this.left,this.y+3*this.height/4,this.x,this.y+3*this.height/4)),line(this.x+this.length,this.y+this.height/4,this.x+this.length+20,this.y+this.height/4),line(this.x+this.length,this.y+3*this.height/4,this.x+this.length+20,this.y+3*this.height/4),strokeWeight(1.2),textSize(14),text("H S",this.x+9,this.y+35),strokeWeight(.7),textSize(10),text("A",this.x-10,this.y+12),text("B",this.x-10,this.y+42),text("S",this.x+44,this.y+12),text("C",this.x+44,this.y+42),strokeWeight(1),this.index>=0&&this.mouseInside()&&null===currentGate&&0===simToggleValue&&null===currentWire?this.closeButton.show():this.closeButton.hide(),i=0;i<this.out.length;i++){var a=this.out[i];mouseX>a.x-10&&mouseX<a.x+10&&mouseY>a.y-10&&mouseY<a.y+10&&0===simToggleValue&&null===currentGate&&0===a.wires.length?a.show():a.hide()}for(i=0;i<this.in.length;i++){var a=this.in[i];mouseX>a.x-10&&mouseX<a.x+10&&mouseY>a.y-10&&mouseY<a.y+10&&0===simToggleValue&&null===currentGate&&0===a.wires.length?a.show():a.hide()}},this.placeTaken=function(a){return a.left<this.right+10&&a.right>this.left-10&&a.up<this.bottom&&a.bottom>this.up},this.clone=function(){return new HalfSubtractor},this.mouseInside=function(){return mouseX>this.left-6&&mouseX<this.right+6&&mouseY>this.up&&mouseY<this.bottom},this.set=function(){this.refreshPosition(),this.index=gates.length,this.name+=this.index;for(var a=0;a<this.inputNum;a++)this.in[a]=new InButton(this,a);for(a=0;a<this.outputNum;a++)this.out[a]=new OutButton(this,a);this.refreshButtons(),this.truthTable=[[[0,0],[1,1],[2,2]],[[1,0],[0,0],[2,2]],[[2,2],[2,2],[2,2]]]},this.refreshButtons=function(){this.in[0].setPosition(this.left,this.y+this.height/4),this.in[1].setPosition(this.left,this.y+3*this.height/4),this.out[0].setPosition(this.right,this.y+this.height/4),this.out[1].setPosition(this.right,this.y+3*this.height/4),this.closeButton.setPosition(this.right-33,this.up+2)},this.delete=function(){for(var a=0;a<this.inputNum;a++)this.in[a].hide();for(a=0;a<this.outputNum;a++)this.out[a].hide();for(this.closeButton.hide(),a=wires.length-1;a>=0;a--)wires[a].inGateIndex!=this.index&&wires[a].outGateIndex!=this.index||deleteWire(wires[a]);refreshWires()},this.refreshPosition=function(){this.x=mouseX,this.y=mouseY-mouseY%5,this.left=this.x-22,this.right=this.x+this.length+22,this.up=this.y,this.bottom=this.y+this.height},this.refresh=function(a){if(this.index!=a){var b=this.index;this.index=a,this.name="HALF_SUBTRACTOR_"+this.index;for(var c=0;c<wires.length;c++)wires[c].inGateIndex==b&&(wires[c].inGateIndex=a),wires[c].outGateIndex==b&&(wires[c].outGateIndex=a);for(c=0;c<this.in.length;c++)this.in[c].refresh();for(c=0;c<this.out.length;c++)this.out[c].refresh()}}}function InSignal(a,b){this.x=a,this.y=b,this.status,this.index=-1,this.name="IN_SIGNAL_",this.length=this.height=20,this.left=this.x,this.right=this.x+this.length+20,this.up=this.y,this.bottom=this.y+this.height,this.closeButton=new CloseButton(this),this.outputNum=1,this.out=[],this.statusButton,this.status=0,this.isInSignal=!0,this.isOutSignal=!1,this.inputs=[],this.draw=function(){for(noFill(),strokeWeight(2),rect(this.x,this.y,this.length,this.height),line(this.right-19,this.up+this.height/2,this.right,this.up+this.height/2),strokeWeight(1),this.index>=0&&this.mouseInside()&&null===currentGate&&0===simToggleValue&&null===currentWire?this.closeButton.show():this.closeButton.hide(),i=0;i<this.out.length;i++){var a=this.out[i];mouseX>a.x-10&&mouseX<a.x+10&&mouseY>a.y-10&&mouseY<a.y+10&&0===simToggleValue&&null===currentGate&&0===a.wires.length?a.show():a.hide()}},this.placeTaken=function(a){return a.left<this.right+10&&a.right>this.left-10&&a.up<this.bottom&&a.bottom>this.up},this.clone=function(){return new InSignal},this.mouseInside=function(){return mouseX>this.left-6&&mouseX<this.right+6&&mouseY>this.up-6&&mouseY<this.bottom+6},this.set=function(){this.refreshPosition(),this.index=gates.length,this.name+=this.index,this.out[0]=new OutButton(this,0),this.statusButton=new StatusButton(this,this.index),this.refreshButtons()},this.refreshButtons=function(){this.out[0].setPosition(this.right,this.up+this.height/2),this.statusButton.setPosition(this.x,this.y),this.closeButton.setPosition(this.right-15,this.up-3)},this.delete=function(){for(this.out[0].hide(),this.statusButton.hide(),this.closeButton.hide(),i=wires.length-1;i>=0;i--)wires[i].inGateIndex!=this.index&&wires[i].outGateIndex!=this.index||deleteWire(wires[i]);refreshWires()},this.refreshPosition=function(){this.x=mouseX,this.y=mouseY-mouseY%5,this.left=this.x,this.right=this.x+this.length+20,this.up=this.y,this.bottom=this.y+this.height},this.refresh=function(a){if(this.index!=a){var b=this.index;this.index=a,this.name="IN_SIGNAL_"+this.index;for(var c=0;c<wires.length;c++)wires[c].outGateIndex==b&&(wires[c].outGateIndex=a);this.out[0].refresh(),this.statusButton.refresh()}},this.switch=function(){this.status=1-this.status,1===this.status?this.statusButton.button.style("background","green"):this.statusButton.button.style("background","red")}}function JkFlipFlop(a,b){this.x=a,this.y=b,this.index=-1,this.name="JK_FLIP_FLOP_",this.length=40,this.height=60,this.left=this.x-20,this.right=this.x+this.length+20,this.up=this.y,this.bottom=this.y+this.height,this.closeButton=new CloseButton(this),this.inputNum=3,this.outputNum=2,this.in=[],this.out=[],this.isInSignal=!1,this.isOutSignal=!1,this.truthTable=[0,0],this.inputs=[0,0,0],this.state=!0,this.previousJ=0,this.previousClk=0,this.previousK=0,this.jk=!0,this.draw=function(){for(noFill(),strokeWeight(2),line(this.x,this.y,this.x+this.length,this.y),line(this.x,this.y+this.height,this.x+this.length,this.y+this.height),line(this.x,this.y,this.x,this.y+this.height),line(this.x+this.length,this.y,this.x+this.length,this.y+this.height),line(this.left,this.y+10,this.x,this.y+10),line(this.left,this.y+30,this.x,this.y+30),line(this.left,this.y+50,this.x,this.y+50),line(this.x+this.length,this.y+this.height/4,this.x+this.length+20,this.y+this.height/4),line(this.x+this.length,this.y+3*this.height/4,this.x+this.length+20,this.y+3*this.height/4),strokeWeight(1.2),textSize(14),text("J K",this.x+9,this.y+35),strokeWeight(.7),textSize(10),text("J",this.x-10,this.y+7),text("Clk",this.x-17,this.y+27),text("K",this.x-10,this.y+47),text("Q",this.x+44,this.y+12),line(this.x+this.length+5,this.y+this.height-28,this.x+this.length+12,this.y+this.height-28),text("Q",this.x+44,this.y+42),strokeWeight(1),this.index>=0&&this.mouseInside()&&null===currentGate&&0===simToggleValue&&null===currentWire?this.closeButton.show():this.closeButton.hide(),i=0;i<this.out.length;i++){var a=this.out[i];mouseX>a.x-10&&mouseX<a.x+10&&mouseY>a.y-10&&mouseY<a.y+10&&0===simToggleValue&&null===currentGate&&0===a.wires.length?a.show():a.hide()}for(i=0;i<this.in.length;i++){var a=this.in[i];mouseX>a.x-10&&mouseX<a.x+10&&mouseY>a.y-10&&mouseY<a.y+10&&0===simToggleValue&&null===currentGate&&0===a.wires.length?a.show():a.hide()}},this.placeTaken=function(a){return a.left<this.right+10&&a.right>this.left-10&&a.up<this.bottom&&a.bottom>this.up},this.clone=function(){return new JkFlipFlop},this.mouseInside=function(){return mouseX>this.left-6&&mouseX<this.right+6&&mouseY>this.up&&mouseY<this.bottom},this.set=function(){this.x=mouseX,this.y=mouseY-mouseY%5,this.index=gates.length,this.name+=this.index;for(var a=0;a<this.inputNum;a++)this.in[a]=new InButton(this,a);for(a=0;a<this.outputNum;a++)this.out[a]=new OutButton(this,a);this.refreshButtons(),this.truthTable=[0,0]},this.refreshButtons=function(){this.in[0].setPosition(this.left,this.y+10),this.in[1].setPosition(this.left,this.y+30),this.in[2].setPosition(this.left,this.y+50),this.out[0].setPosition(this.right,this.y+this.height/4),this.out[1].setPosition(this.right,this.y+3*this.height/4),this.closeButton.setPosition(this.right-33,this.up+2)},this.delete=function(){for(var a=0;a<this.inputNum;a++)this.in[a].hide();for(a=0;a<this.outputNum;a++)this.out[a].hide();for(this.closeButton.hide(),a=wires.length-1;a>=0;a--)wires[a].inGateIndex!=this.index&&wires[a].outGateIndex!=this.index||deleteWire(wires[a]);refreshWires()},this.refreshPosition=function(){this.x=mouseX,this.y=mouseY-mouseY%5,this.left=this.x-22,this.right=this.x+this.length+22,this.up=this.y,this.bottom=this.y+this.height},this.refresh=function(a){if(this.index!=a){var b=this.index;this.index=a,this.name="JK_FLIP_FLOP_"+this.index;for(var c=0;c<wires.length;c++)wires[c].inGateIndex==b&&(wires[c].inGateIndex=a),wires[c].outGateIndex==b&&(wires[c].outGateIndex=a);for(c=0;c<this.in.length;c++)this.in[c].refresh();for(c=0;c<this.out.length;c++)this.out[c].refresh()}},this.switch=function(){var a=this.inputs[0],b=this.inputs[1],c=this.inputs[2];0===this.truthTable[0]&&0===this.truthTable[1]?0===b&&1===this.previousClk&&(this.truthTable=0===a?[0,1]:[1,0]):0===this.truthTable[0]&&1===this.truthTable[1]?0===b&&1===this.previousClk&&1===a&&(this.truthTable=[1,0]):1===this.truthTable[0]&&0===this.truthTable[1]&&0===b&&1===this.previousClk&&1===c&&(this.truthTable=[0,1]),this.previousClk=b,this.previousJ=a,this.previousK=c}}function Mux(a,b){this.x=a,this.y=b,this.index=-1,this.name="MUX_",this.length=40,this.height=80,this.left=this.x-22,this.right=this.x+this.length+22,this.up=this.y,this.bottom=this.y+this.height+10,this.closeButton=new CloseButton(this),this.inputNum=6,this.outputNum=1,this.in=[],this.out=[],this.isInSignal=!1,this.isOutSignal=!1,this.mux=!0,this.truthTable=[],this.inputs=[0,0,0,0,0,0],this.draw=function(){noFill(),strokeWeight(2),line(this.x,this.y,this.x+this.length,this.y+20),line(this.x,this.y+this.height,this.x+this.length,this.y+this.height-20),line(this.x,this.y,this.x,this.y+this.height),line(this.x+this.length,this.y+20,this.x+this.length,this.y+this.height-20),line(this.x+this.length,this.y+40,this.right,this.y+40),line(this.x+10,this.y+this.height-5,this.x+10,this.y+this.height+15),line(this.x+30,this.y+this.height-14,this.x+30,this.y+this.height+15);for(var a=0;a<this.inputNum-2;a++)line(this.left,this.y+10+20*a,this.x,this.y+10+20*a);for(strokeWeight(.7),textSize(9),text("I0",this.x-12,this.y+8),text("I1",this.x-12,this.y+28),text("I2",this.x-12,this.y+48),text("I3",this.x-12,this.y+68),text("S1",this.x-3,this.y+this.height+10),text("S0",this.x+17,this.y+this.height+10),strokeWeight(1),textSize(12),text("MUX\n 4/1",this.x+6,this.y+36),strokeWeight(1),this.index>=0&&this.mouseInside()&&null===currentGate&&0===simToggleValue&&null===currentWire?this.closeButton.show():this.closeButton.hide(),a=0;a<this.out.length;a++){var b=this.out[a];mouseX>b.x-10&&mouseX<b.x+10&&mouseY>b.y-10&&mouseY<b.y+10&&0===simToggleValue&&null===currentGate&&0===b.wires.length?b.show():b.hide()}for(a=0;a<this.in.length;a++){var b=this.in[a];mouseX>b.x-6&&mouseX<b.x+6&&mouseY>b.y-6&&mouseY<b.y+6&&0===simToggleValue&&null===currentGate&&0===b.wires.length?b.show():b.hide()}},this.placeTaken=function(a){return a.left<this.right&&a.right>this.left&&a.up<this.bottom&&a.bottom>this.up},this.clone=function(){return new Mux},this.mouseInside=function(){return mouseX>this.left-6&&mouseX<this.right+6&&mouseY>this.up&&mouseY<this.bottom},this.set=function(){this.refreshPosition(),this.index=gates.length,this.name+=this.index;for(var a=0;a<this.inputNum;a++)this.in[a]=new InButton(this,a);for(a=0;a<this.outputNum;a++)this.out[a]=new OutButton(this,a);this.refreshButtons()},this.refreshButtons=function(){for(i=0;i<this.inputNum-2;i++)this.in[i].setPosition(this.left,this.y+10+20*i);this.in[4].setPosition(this.x+10,this.y+this.height+15),this.in[5].setPosition(this.x+30,this.y+this.height+15),this.out[0].setPosition(this.right,this.y+40),this.closeButton.setPosition(this.right-33,this.up+2)},this.delete=function(){for(var a=0;a<this.inputNum;a++)this.in[a].hide();for(this.closeButton.hide(),a=wires.length-1;a>=0;a--)wires[a].inGateIndex!=this.index&&wires[a].outGateIndex!=this.index||deleteWire(wires[a]);refreshWires()},this.refreshPosition=function(){this.x=mouseX,this.y=mouseY-mouseY%5,this.left=this.x-22,this.right=this.x+this.length+22,this.up=this.y,this.bottom=this.y+this.height+15},this.refresh=function(a){if(this.index!=a){var b=this.index;this.index=a,this.name="MUX_"+this.index;for(var c=0;c<wires.length;c++)wires[c].inGateIndex==b&&(wires[c].inGateIndex=a),wires[c].outGateIndex==b&&(wires[c].outGateIndex=a);for(c=0;c<this.in.length;c++)this.in[c].refresh();for(c=0;c<this.out.length;c++)this.out[c].refresh()}},this.output=function(){var a=[[this.inputs[0],this.inputs[1]],[this.inputs[2],this.inputs[3]]];if(2===this.inputs[4]||2===this.inputs[5])return 2;var b=a[this.inputs[4]][this.inputs[5]];return void 0===b?2:b}}function NandGate(a,b){this.x=a,this.y=b,this.index=-1,this.name="NAND_GATE_",this.length=20,this.height=40,this.left=this.x-20,this.right=this.x+1.5*this.length+38,this.up=this.y,this.bottom=this.y+this.height,this.closeButton=new CloseButton(this),this.inputNum=2,this.outputNum=1,this.in=[],this.out=[],this.isInSignal=!1,this.isOutSignal=!1,this.truthTable=[],this.inputs=[0,0],this.draw=function(){if(noFill(),strokeWeight(2),line(this.x,this.y,this.x+this.length,this.y),line(this.x,this.y+this.height,this.x+this.length,this.y+this.height),line(this.x,this.y,this.x,this.y+this.height),arc(this.x+this.length,this.y+this.height/2,this.length+15,this.height,3*HALF_PI,HALF_PI),ellipse(this.x+this.length+23,this.y+this.height/2,10,10),2==this.inputNum)line(this.left,this.y+this.height/4,this.x,this.y+this.height/4),line(this.left,this.y+3*this.height/4,this.x,this.y+3*this.height/4);else for(var a=0;a<this.inputNum;a++)line(this.left,this.y+(a+1)*this.height/(this.inputNum+1),this.x,this.y+(a+1)*this.height/(this.inputNum+1));for(a=0;a<this.outputNum;a++)line(this.right-20,this.y+(a+1)*this.height/(this.outputNum+1),this.right-4,this.y+(a+1)*this.height/(this.outputNum+1));for(strokeWeight(1),this.index>=0&&this.mouseInside()&&null===currentGate&&0===simToggleValue&&null===currentWire?this.closeButton.show():this.closeButton.hide(),a=0;a<this.out.length;a++){var b=this.out[a];mouseX>b.x-10&&mouseX<b.x+10&&mouseY>b.y-10&&mouseY<b.y+10&&0===simToggleValue&&null===currentGate&&0===b.wires.length?b.show():b.hide()}for(a=0;a<this.in.length;a++){var b=this.in[a];mouseX>b.x-10&&mouseX<b.x+10&&mouseY>b.y-10&&mouseY<b.y+10&&0===simToggleValue&&null===currentGate&&0===b.wires.length?b.show():b.hide()}},this.placeTaken=function(a){return a.left<this.right+10&&a.right>this.left-10&&a.up<this.bottom&&a.bottom>this.up},this.clone=function(){return new NandGate},this.mouseInside=function(){return mouseX>this.left-6&&mouseX<this.right+6&&mouseY>this.up&&mouseY<this.bottom},this.set=function(){for(this.refreshPosition(),this.index=gates.length,this.name+=this.index,i=0;i<this.inputNum;i++)this.in[i]=new InButton(this,i);for(i=0;i<this.outputNum;i++)this.out[i]=new OutButton(this,i);this.refreshButtons(),this.truthTable=[[1,1,1],[1,0,2],[1,2,2]]},this.refreshButtons=function(){if(2==this.inputNum)this.in[0].setPosition(this.left,this.y+this.height/4),this.in[1].setPosition(this.left,this.y+3*this.height/4);else for(i=0;i<this.inputNum;i++)this.in[i].setPosition(this.left,this.y+(i+1)*this.height/(this.inputNum+1));for(i=0;i<this.outputNum;i++)this.out[i].setPosition(this.right-3,this.y+(i+1)*this.height/(this.outputNum+1));this.closeButton.setPosition(this.right-20,this.up)},this.delete=function(){for(var a=0;a<this.inputNum;a++)this.in[a].hide();for(a=0;a<this.outputNum;a++)this.out[a].hide();for(this.closeButton.hide(),a=wires.length-1;a>=0;a--)wires[a].inGateIndex!=this.index&&wires[a].outGateIndex!=this.index||deleteWire(wires[a]);refreshWires()},this.refreshPosition=function(){this.x=mouseX,this.y=mouseY-mouseY%5,this.left=this.x-20,this.right=this.x+1.5*this.length+38,this.up=this.y,this.bottom=this.y+this.height},this.refresh=function(a){if(this.index!=a){var b=this.index;this.index=a,this.name="NAND_GATE_"+this.index;for(var c=0;c<wires.length;c++)wires[c].inGateIndex==b&&(wires[c].inGateIndex=a),wires[c].outGateIndex==b&&(wires[c].outGateIndex=a);for(c=0;c<this.in.length;c++)this.in[c].refresh();for(c=0;c<this.out.length;c++)this.out[c].refresh()}}}function NorGate(a,b){this.x=a,this.y=b,this.index=-1,this.name="NOR_GATE_",this.length=16,this.height=40,this.left=this.x-20,this.right=this.x+1.5*this.length+45,this.up=this.y,this.bottom=this.y+this.height,this.closeButton=new CloseButton,this.inputNum=2,this.outputNum=1,this.in=[],this.out=[],this.isInSignal=!1,this.isOutSignal=!1,this.truthTable=[],this.inputs=[0,0],this.draw=function(){if(noFill(),strokeWeight(2),line(this.x,this.y,this.x+this.length,this.y),line(this.x,this.y+this.height,this.x+this.length,this.y+this.height),arc(this.x-this.length-18,this.y+this.height/2,2*this.height+1,2*this.height-1,-1/3*HALF_PI,1/3*HALF_PI),arc(this.x+this.length,this.y+this.height/2,this.length+29,this.height,3*HALF_PI,HALF_PI),ellipse(this.x+this.length+28,this.y+this.height/2,10,10),2==this.inputNum)line(this.left,this.y+this.height/4,this.x+5,this.y+this.height/4),line(this.left,this.y+3*this.height/4,this.x+5,this.y+3*this.height/4);else for(var a=0;a<this.inputNum;a++)line(this.left,this.y+(a+1)*this.height/(this.inputNum+1),this.x+5,this.y+(a+1)*this.height/(this.inputNum+1));for(a=0;a<this.outputNum;a++)line(this.right-20,this.y+(a+1)*this.height/(this.outputNum+1),this.right-3,this.y+(a+1)*this.height/(this.outputNum+1));for(strokeWeight(1),this.index>=0&&this.mouseInside()&&null===currentGate&&0===simToggleValue&&null===currentWire?this.closeButton.show():this.closeButton.hide(),a=0;a<this.out.length;a++){var b=this.out[a];mouseX>b.x-10&&mouseX<b.x+10&&mouseY>b.y-10&&mouseY<b.y+10&&0===simToggleValue&&null===currentGate&&0===b.wires.length?b.show():b.hide()}for(a=0;a<this.in.length;a++){var b=this.in[a];mouseX>b.x-10&&mouseX<b.x+10&&mouseY>b.y-10&&mouseY<b.y+10&&0===simToggleValue&&null===currentGate&&0===b.wires.length?b.show():b.hide()}},this.placeTaken=function(a){return a.left<this.right+10&&a.right>this.left-10&&a.up<this.bottom&&a.bottom>this.up},this.clone=function(){return new NorGate},this.mouseInside=function(){return mouseX>this.left-6&&mouseX<this.right+6&&mouseY>this.up&&mouseY<this.bottom},this.set=function(){for(this.refreshPosition(),this.index=gates.length,this.name+=this.index,i=0;i<this.inputNum;i++)this.in[i]=new InButton(this,i);for(i=0;i<this.outputNum;i++)this.out[i]=new OutButton(this,i);this.refreshButtons(),this.truthTable=[[1,0,2],[0,0,0],[2,0,2]]},this.refreshButtons=function(){if(2==this.inputNum)this.in[0].setPosition(this.left,this.y+this.height/4),this.in[1].setPosition(this.left,this.y+3*this.height/4);else for(i=0;i<this.inputNum;i++)this.in[i].setPosition(this.left,this.y+(i+1)*this.height/(this.inputNum+1));for(i=0;i<this.outputNum;i++)this.out[i].setPosition(this.right-2,this.y+(i+1)*this.height/(this.outputNum+1));this.closeButton.setPosition(this.right-20,this.up)},this.delete=function(){for(var a=0;a<this.inputNum;a++)this.in[a].hide();for(a=0;a<this.outputNum;a++)this.out[a].hide();for(this.closeButton.hide(),a=wires.length-1;a>=0;a--)wires[a].inGateIndex!=this.index&&wires[a].outGateIndex!=this.index||deleteWire(wires[a]);refreshWires()},this.refreshPosition=function(){this.x=mouseX,this.y=mouseY-mouseY%5,this.left=this.x-20,this.right=this.x+1.5*this.length+45,this.up=this.y,this.bottom=this.y+this.height},this.refresh=function(a){if(this.index!=a){var b=this.index;this.index=a,this.name="NOR_GATE_"+this.index;for(var c=0;c<wires.length;c++)wires[c].inGateIndex==b&&(wires[c].inGateIndex=a),wires[c].outGateIndex==b&&(wires[c].outGateIndex=a);for(c=0;c<this.in.length;c++)this.in[c].refresh();for(c=0;c<this.out.length;c++)this.out[c].refresh()}}}function NotGate(a,b){this.x=a,this.y=b,this.index=-1,this.name="NOT_GATE_",this.length=14,this.height=20,this.left=this.x-10,this.right=this.x+this.length+17,this.up=this.y,this.bottom=this.y+this.height,this.closeButton=new CloseButton(this),this.inputNum=1,this.outputNum=1,this.in=[],this.out=[],this.isInSignal=!1,this.truthTable=[],this.inputs=[0,0],this.draw=function(){for(noFill(),strokeWeight(2),line(this.x,this.y,this.x+this.length,this.y+this.height/2),line(this.x,this.y,this.x,this.y+this.height),line(this.x,this.y+this.height,this.x+this.length,this.y+this.height/2),line(this.left,this.y+this.height/2,this.x,this.y+this.height/2),ellipse(this.x+this.length+5,this.y+this.height/2,8,8),line(this.x+this.length+10,this.y+this.height/2,this.right,this.y+this.height/2),strokeWeight(1),this.index>=0&&this.mouseInside()&&null===currentGate&&0===simToggleValue&&null===currentWire?this.closeButton.show():this.closeButton.hide(),i=0;i<this.out.length;i++){var a=this.out[i];mouseX>a.x-10&&mouseX<a.x+10&&mouseY>a.y-10&&mouseY<a.y+10&&0===simToggleValue&&null===currentGate&&0===a.wires.length?a.show():a.hide()}for(i=0;i<this.in.length;i++){var a=this.in[i];mouseX>a.x-10&&mouseX<a.x+10&&mouseY>a.y-10&&mouseY<a.y+10&&0===simToggleValue&&null===currentGate&&0===a.wires.length?a.show():a.hide()}},this.placeTaken=function(a){return a.left<this.right+10&&a.right>this.left-10&&a.up<this.bottom&&a.bottom>this.up},this.clone=function(){return new NotGate},this.mouseInside=function(){return mouseX>this.left-6&&mouseX<this.right+6&&mouseY>this.up&&mouseY<this.bottom},this.set=function(){this.refreshPosition(),this.index=gates.length,this.name+=this.index,this.in[0]=new InButton(this,0),this.out[0]=new OutButton(this,0),this.refreshButtons(),this.truthTable=[1,0,2]},this.refreshButtons=function(){this.in[0].setPosition(this.left,this.y+this.height/2),this.out[0].setPosition(this.right,this.y+this.height/2),this.closeButton.setPosition(this.right-40,this.up-5)},this.delete=function(){for(var a=0;a<this.inputNum;a++)this.in[a].hide();for(a=0;a<this.outputNum;a++)this.out[a].hide();for(this.closeButton.hide(),a=wires.length-1;a>=0;a--)wires[a].inGateIndex!=this.index&&wires[a].outGateIndex!=this.index||deleteWire(wires[a]);refreshWires()},this.refreshPosition=function(){this.x=mouseX,this.y=mouseY-mouseY%5,this.left=this.x-10,this.right=this.x+this.length+17,this.up=this.y,this.bottom=this.y+this.height},this.refresh=function(a){if(this.index!=a){var b=this.index;this.index=a,this.name="AND_GATE_"+this.index;for(var c=0;c<wires.length;c++)wires[c].inGateIndex==b&&(wires[c].inGateIndex=a),wires[c].outGateIndex==b&&(wires[c].outGateIndex=a);for(c=0;c<this.in.length;c++)this.in[c].refresh();for(c=0;c<this.out.length;c++)this.out[c].refresh()}}}function OrGate(a,b){this.x=a,this.y=b,this.index=-1,this.name="OR_GATE_",this.length=16,this.height=40,this.left=this.x-20,this.right=this.x+1.5*this.length+35,this.up=this.y,this.bottom=this.y+this.height,this.closeButton=new CloseButton,this.inputNum=2,this.outputNum=1,this.in=[],this.out=[],this.isInSignal=!1,this.isOutSignal=!1,this.truthTable=[],this.inputs=[0,0],this.draw=function(){if(noFill(),strokeWeight(2),line(this.x,this.y,this.x+this.length,this.y),line(this.x,this.y+this.height,this.x+this.length,this.y+this.height),arc(this.x-this.length-18,this.y+this.height/2,2*this.height+1,2*this.height-1,-1/3*HALF_PI,1/3*HALF_PI),arc(this.x+this.length,this.y+this.height/2,this.length+30,this.height,3*HALF_PI,HALF_PI),2==this.inputNum)line(this.left,this.y+this.height/4,this.x+5,this.y+this.height/4),line(this.left,this.y+3*this.height/4,this.x+5,this.y+3*this.height/4);else for(var a=0;a<this.inputNum;a++)line(this.left,this.y+(a+1)*this.height/(this.inputNum+1),this.x+5,this.y+(a+1)*this.height/(this.inputNum+1));for(a=0;a<this.outputNum;a++)line(this.right-20,this.y+(a+1)*this.height/(this.outputNum+1),this.right,this.y+(a+1)*this.height/(this.outputNum+1));for(strokeWeight(1),this.index>=0&&this.mouseInside()&&null===currentGate&&0===simToggleValue&&null===currentWire?this.closeButton.show():this.closeButton.hide(),a=0;a<this.out.length;a++){var b=this.out[a];mouseX>b.x-10&&mouseX<b.x+10&&mouseY>b.y-10&&mouseY<b.y+10&&0===simToggleValue&&null===currentGate&&0===b.wires.length?b.show():b.hide()}for(a=0;a<this.in.length;a++){var b=this.in[a];mouseX>b.x-10&&mouseX<b.x+10&&mouseY>b.y-10&&mouseY<b.y+10&&0===simToggleValue&&null===currentGate&&0===b.wires.length?b.show():b.hide()}},this.placeTaken=function(a){return a.left<this.right+10&&a.right>this.left-10&&a.up<this.bottom&&a.bottom>this.up},this.clone=function(){return new OrGate},this.mouseInside=function(){return mouseX>this.left-6&&mouseX<this.right+6&&mouseY>this.up&&mouseY<this.bottom},this.set=function(){for(this.refreshPosition(),this.index=gates.length,this.name+=this.index,i=0;i<this.inputNum;i++)this.in[i]=new InButton(this,i);for(i=0;i<this.outputNum;i++)this.out[i]=new OutButton(this,i);this.refreshButtons(),this.truthTable=[[0,1,2],[1,1,1],[2,1,2]]},this.refreshButtons=function(){if(2==this.inputNum)this.in[0].setPosition(this.left,this.y+this.height/4),this.in[1].setPosition(this.left,this.y+3*this.height/4);else for(i=0;i<this.inputNum;i++)this.in[i].setPosition(this.left,this.y+(i+1)*this.height/(this.inputNum+1));for(i=0;i<this.outputNum;i++)this.out[i].setPosition(this.right,this.y+(i+1)*this.height/(this.outputNum+1));this.closeButton.setPosition(this.right-20,this.up)},this.delete=function(){for(var a=0;a<this.inputNum;a++)this.in[a].hide();for(a=0;a<this.outputNum;a++)this.out[a].hide();for(this.closeButton.hide(),a=wires.length-1;a>=0;a--)wires[a].inGateIndex!=this.index&&wires[a].outGateIndex!=this.index||deleteWire(wires[a]);refreshWires()},this.refreshPosition=function(){this.x=mouseX,this.y=mouseY-mouseY%5,this.left=this.x-20,this.right=this.x+1.5*this.length+35,this.up=this.y,this.bottom=this.y+this.height},this.refresh=function(a){if(this.index!=a){var b=this.index;this.index=a,this.name="OR_GATE_"+this.index;for(var c=0;c<wires.length;c++)wires[c].inGateIndex==b&&(wires[c].inGateIndex=a),wires[c].outGateIndex==b&&(wires[c].outGateIndex=a);for(c=0;c<this.in.length;c++)this.in[c].refresh();for(c=0;c<this.out.length;c++)this.out[c].refresh()}}}function OutSignal(a,b){this.x=a,this.y=b,this.status,this.index=-1,this.name="OUT_SIGNAL_",this.length=this.height=20,this.left=this.x-20,this.right=this.x+this.length,this.up=this.y,this.bottom=this.y+this.height,this.closeButton=new CloseButton(this),this.inputNum=1,this.outputNum=0,this.in=[],this.isInSignal=!1,this.isOutSignal=!0,this.inputs=[0],this.status=2,this.color=color(255),this.draw=function(){for(fill(this.color),strokeWeight(2),ellipse(this.x+this.length/2,this.y+this.length/2,this.length,this.height),line(this.left+1,this.up+this.height/2,this.left+20,this.up+this.height/2),strokeWeight(1),this.index>=0&&this.mouseInside()&&null===currentGate&&0===simToggleValue&&null===currentWire?this.closeButton.show():this.closeButton.hide(),i=0;i<this.in.length;i++){var a=this.in[i];mouseX>a.x-10&&mouseX<a.x+10&&mouseY>a.y-10&&mouseY<a.y+10&&0===simToggleValue&&null===currentGate&&0===a.wires.length?a.show():a.hide()}},this.placeTaken=function(a){return a.left<this.right+10&&a.right>this.left-10&&a.up<this.bottom&&a.bottom>this.up},this.clone=function(){return new OutSignal},this.mouseInside=function(){return mouseX>this.left-6&&mouseX<this.right+6&&mouseY>this.up-6&&mouseY<this.bottom+6},this.set=function(){this.refreshPosition(),this.index=gates.length,this.name+=this.index,this.in[0]=new InButton(this,0),this.refreshButtons()},this.refreshButtons=function(){this.in[0].setPosition(this.left,this.up+this.height/2),this.closeButton.setPosition(this.left+6,this.up-3)},this.delete=function(){for(this.in[0].hide(),this.closeButton.hide(),i=wires.length-1;i>=0;i--)wires[i].inGateIndex==this.index&&deleteWire(wires[i]);refreshWires()},this.refreshPosition=function(){this.x=mouseX,this.y=mouseY-mouseY%5,this.left=this.x-20,this.right=this.x+this.length,this.up=this.y,this.bottom=this.y+this.height},this.refresh=function(a){if(this.index!=a){var b=this.index;this.index=a,this.name="IN_SIGNAL_"+this.index;for(var c=0;c<wires.length;c++)wires[c].inGateIndex==b&&(wires[c].inGateIndex=a);this.in[0].refresh()}},this.evaluate=function(){this.status=this.in.wire.status},this.switch=function(a){this.status=a,2===this.status?this.color=color(255):1===this.status?this.color=color(0,255,0):0===this.status&&(this.color=color(255,0,0))}}function SevenSegDisplay(a,b){this.x=a,this.y=b,this.index=-1,this.name="SEVEN_SEG_DISPLAY_",this.length=55,this.height=110,this.left=this.x-10,this.right=this.x+this.length+10,this.up=this.y,this.bottom=this.y+this.height,this.closeButton=new CloseButton(this),this.inputNum=7,this.outputNum=0,this.in=[],this.out=[],this.isInSignal=!1,this.isOutSignal=!1,this.truthTable=[],this.inputs=[0,0,0,0,0,0,0],this.sevenSeg=!0,this.status=[0,0,0,0,0,0,0],this.colorGrey=color(225,225,225),this.colorRed=color(200,0,0),this.colorGreen=color(0,255,0),this.color=[this.colorGrey,this.colorGrey,this.colorGrey,this.colorGrey,this.colorGrey,this.colorGrey,this.colorGrey],this.draw=function(){noFill(),strokeWeight(2),line(this.x,this.y,this.x+this.length,this.y),line(this.x,this.y+this.height,this.x+this.length,this.y+this.height),line(this.x,this.y,this.x,this.y+this.height),line(this.x+this.length,this.y,this.x+this.length,this.y+this.height),strokeWeight(8),stroke(this.color[0]),line(this.x+15,this.y+10,this.x+this.length-14,this.y+10),stroke(this.color[5]),line(this.x+9,this.y+17,this.x+8,this.y+this.height/2-5),stroke(this.color[1]),line(this.x+this.length-8,this.y+17,this.x+this.length-9,this.y+this.height/2-5),stroke(this.color[6]),line(this.x+14,this.y+this.height/2,this.x+this.length-14,this.y+this.height/2),stroke(this.color[4]),line(this.x+9,this.y+this.height/2+5,this.x+8,this.y+this.height-17),stroke(this.color[2]),line(this.x+this.length-8,this.y+this.height/2+5,this.x+this.length-9,this.y+this.height-17),stroke(this.color[3]),line(this.x+14,this.y+this.height-10,this.x+this.length-15,this.y+this.height-10),stroke(0),strokeWeight(2);for(var a=0;a<this.inputNum;a++)line(this.left,this.y+10+15*a,this.x,this.y+10+15*a);for(strokeWeight(.7),textSize(9),text("A",this.x-10,this.y+8),text("B",this.x-10,this.y+23),text("C",this.x-10,this.y+38),text("D",this.x-10,this.y+53),text("E",this.x-10,this.y+68),text("F",this.x-10,this.y+83),text("G",this.x-10,this.y+98),strokeWeight(1),this.index>=0&&this.mouseInside()&&null===currentGate&&0===simToggleValue&&null===currentWire?this.closeButton.show():this.closeButton.hide(),a=0;a<this.in.length;a++){var b=this.in[a];mouseX>b.x-6&&mouseX<b.x+6&&mouseY>b.y-6&&mouseY<b.y+6&&0===simToggleValue&&null===currentGate&&0===b.wires.length?b.show():b.hide()}},this.placeTaken=function(a){return a.left<this.right+10&&a.right>this.left-10&&a.up<this.bottom&&a.bottom>this.up},this.clone=function(){return new SevenSegDisplay},this.mouseInside=function(){return mouseX>this.left-6&&mouseX<this.right+6&&mouseY>this.up&&mouseY<this.bottom},this.set=function(){this.refreshPosition(),this.index=gates.length,this.name+=this.index;for(var a=0;a<this.inputNum;a++)this.in[a]=new InButton(this,a),this.in[a].setPosition(this.left,this.y+10+15*a);this.refreshButtons()},this.refreshButtons=function(){for(var a=0;a<this.inputNum;a++)this.in[a].setPosition(this.left,this.y+10+15*a);this.closeButton.setPosition(this.right-33,this.up+2)},this.delete=function(){for(var a=0;a<this.inputNum;a++)this.in[a].hide();for(this.closeButton.hide(),a=wires.length-1;a>=0;a--)wires[a].inGateIndex!=this.index&&wires[a].outGateIndex!=this.index||deleteWire(wires[a]);refreshWires()},this.refreshPosition=function(){this.x=mouseX,this.y=mouseY-mouseY%5,this.left=this.x-20,this.right=this.x+this.length,this.up=this.y,this.bottom=this.y+this.height},this.refresh=function(a){if(this.index!=a){var b=this.index;this.index=a,this.name="SEVEN_SEG_DISPLAY_"+this.index;for(var c=0;c<wires.length;c++)wires[c].inGateIndex==b&&(wires[c].inGateIndex=a),wires[c].outGateIndex==b&&(wires[c].outGateIndex=a);for(c=0;c<this.in.length;c++)this.in[c].refresh()}},this.switch=function(a){this.status=a;for(var b=0;b<a.length;b++)0===a[b]?this.color[b]=this.colorGrey:1===a[b]?this.color[b]=this.colorRed:this.color[b]=this.colorGrey}}function SrLatch(a,b){this.x=a,this.y=b,this.index=-1,this.name="SR_LATCH_",this.length=40,this.height=60,this.left=this.x-20,this.right=this.x+this.length+20,this.up=this.y,this.bottom=this.y+this.height,this.closeButton=new CloseButton(this),this.inputNum=2,this.outputNum=2,this.in=[],this.out=[],this.isInSignal=!1,this.isOutSignal=!1,this.truthTable=[],this.inputs=[0,0],this.draw=function(){for(noFill(),strokeWeight(2),line(this.x,this.y,this.x+this.length,this.y),line(this.x,this.y+this.height,this.x+this.length,this.y+this.height),line(this.x,this.y,this.x,this.y+this.height),line(this.x+this.length,this.y,this.x+this.length,this.y+this.height),2==this.inputNum&&(line(this.left,this.y+this.height/4,this.x,this.y+this.height/4),line(this.left,this.y+3*this.height/4,this.x,this.y+3*this.height/4)),line(this.x+this.length,this.y+this.height/4,this.x+this.length+20,this.y+this.height/4),line(this.x+this.length,this.y+3*this.height/4,this.x+this.length+20,this.y+3*this.height/4),strokeWeight(1.2),textSize(14),text("S R",this.x+9,this.y+35),strokeWeight(.7),textSize(10),text("S",this.x-10,this.y+12),text("R",this.x-10,this.y+42),text("Q",this.x+44,this.y+12),line(this.x+this.length+5,this.y+this.height-28,this.x+this.length+12,this.y+this.height-28),text("Q",this.x+44,this.y+42),strokeWeight(1),this.index>=0&&this.mouseInside()&&null===currentGate&&0===simToggleValue&&null===currentWire?this.closeButton.show():this.closeButton.hide(),i=0;i<this.out.length;i++){var a=this.out[i];mouseX>a.x-10&&mouseX<a.x+10&&mouseY>a.y-10&&mouseY<a.y+10&&0===simToggleValue&&null===currentGate&&0===a.wires.length?a.show():a.hide()}for(i=0;i<this.in.length;i++){var a=this.in[i];mouseX>a.x-10&&mouseX<a.x+10&&mouseY>a.y-10&&mouseY<a.y+10&&0===simToggleValue&&null===currentGate&&0===a.wires.length?a.show():a.hide()}},this.placeTaken=function(a){return a.left<this.right+10&&a.right>this.left-10&&a.up<this.bottom&&a.bottom>this.up},this.clone=function(){return new SrLatch},this.mouseInside=function(){return mouseX>this.left-6&&mouseX<this.right+6&&mouseY>this.up&&mouseY<this.bottom},this.set=function(){this.refreshPosition(),this.index=gates.length,this.name+=this.index;for(var a=0;a<this.inputNum;a++)this.in[a]=new InButton(this,a);for(a=0;a<this.outputNum;a++)this.out[a]=new OutButton(this,a);this.refreshButtons(),this.truthTable=[[[0,0],[1,1],[2,2]],[[1,0],[0,0],[2,2]],[[2,2],[2,2],[2,2]]]},this.refreshButtons=function(){this.in[0].setPosition(this.left,this.y+this.height/4),this.in[1].setPosition(this.left,this.y+3*this.height/4),this.out[0].setPosition(this.right,this.y+this.height/4),this.out[1].setPosition(this.right,this.y+3*this.height/4),this.closeButton.setPosition(this.right-33,this.up+2)},this.delete=function(){for(var a=0;a<this.inputNum;a++)this.in[a].hide();for(a=0;a<this.outputNum;a++)this.out[a].hide();for(this.closeButton.hide(),a=wires.length-1;a>=0;a--)wires[a].inGateIndex!=this.index&&wires[a].outGateIndex!=this.index||deleteWire(wires[a]);refreshWires()},this.refreshPosition=function(){this.x=mouseX,this.y=mouseY-mouseY%5,this.left=this.x-22,this.right=this.x+this.length+22,this.up=this.y,this.bottom=this.y+this.height},this.refresh=function(a){if(this.index!=a){var b=this.index;this.index=a,this.name="SR_LATCH_"+this.index;for(var c=0;c<wires.length;c++)wires[c].inGateIndex==b&&(wires[c].inGateIndex=a),wires[c].outGateIndex==b&&(wires[c].outGateIndex=a);for(c=0;c<this.in.length;c++)this.in[c].refresh();for(c=0;c<this.out.length;c++)this.out[c].refresh()}}}function TFlipFlop(a,b){this.x=a,this.y=b,this.index=-1,this.name="T_FLIP_FLOP_",this.length=40,this.height=60,this.left=this.x-20,this.right=this.x+this.length+20,this.up=this.y,this.bottom=this.y+this.height,this.closeButton=new CloseButton(this),this.inputNum=2,this.outputNum=2,this.in=[],this.out=[],this.isInSignal=!1,this.isOutSignal=!1,this.state=!0,this.previousClk=0,this.previousD=0,this.truthTable=[0,1],this.inputs=[0,0],this.draw=function(){for(noFill(),strokeWeight(2),line(this.x,this.y,this.x+this.length,this.y),line(this.x,this.y+this.height,this.x+this.length,this.y+this.height),line(this.x,this.y,this.x,this.y+this.height),line(this.x+this.length,this.y,this.x+this.length,this.y+this.height),2==this.inputNum&&(line(this.left,this.y+this.height/4,this.x,this.y+this.height/4),line(this.left,this.y+3*this.height/4,this.x,this.y+3*this.height/4)),line(this.x+this.length,this.y+this.height/4,this.x+this.length+20,this.y+this.height/4),line(this.x+this.length,this.y+3*this.height/4,this.x+this.length+20,this.y+3*this.height/4),strokeWeight(1.2),textSize(14),text("T",this.x+15,this.y+35),strokeWeight(.7),textSize(10),text("T",this.x-10,this.y+12),text("E",this.x-10,this.y+42),text("Q",this.x+44,this.y+12),text("Q",this.x+44,this.y+42),strokeWeight(1),line(this.x+this.length+4,this.y+this.height-28,this.x+this.length+11,this.y+this.height-28),this.index>=0&&this.mouseInside()&&null===currentGate&&0===simToggleValue&&null===currentWire?this.closeButton.show():this.closeButton.hide(),i=0;i<this.out.length;i++){var a=this.out[i];mouseX>a.x-10&&mouseX<a.x+10&&mouseY>a.y-10&&mouseY<a.y+10&&0===simToggleValue&&null===currentGate&&0===a.wires.length?a.show():a.hide()}for(i=0;i<this.in.length;i++){var a=this.in[i];mouseX>a.x-10&&mouseX<a.x+10&&mouseY>a.y-10&&mouseY<a.y+10&&0===simToggleValue&&null===currentGate&&0===a.wires.length?a.show():a.hide()}},this.placeTaken=function(a){return a.left<this.right+10&&a.right>this.left-10&&a.up<this.bottom&&a.bottom>this.up},this.clone=function(){return new TFlipFlop},this.mouseInside=function(){return mouseX>this.left-6&&mouseX<this.right+6&&mouseY>this.up&&mouseY<this.bottom},this.set=function(){this.x=mouseX,this.y=mouseY-mouseY%5,this.index=gates.length,this.name+=this.index;for(var a=0;a<this.inputNum;a++)this.in[a]=new InButton(this,a);for(a=0;a<this.outputNum;a++)this.out[a]=new OutButton(this,a);this.refreshButtons(),this.truthTable=[0,1]},this.refreshButtons=function(){this.in[0].setPosition(this.left,this.y+this.height/4),this.in[1].setPosition(this.left,this.y+3*this.height/4),this.out[0].setPosition(this.right,this.y+this.height/4),this.out[1].setPosition(this.right,this.y+3*this.height/4),this.closeButton.setPosition(this.right-33,this.up+2)},this.delete=function(){for(var a=0;a<this.inputNum;a++)this.in[a].hide();for(a=0;a<this.outputNum;a++)this.out[a].hide();for(this.closeButton.hide(),a=wires.length-1;a>=0;a--)wires[a].inGateIndex!=this.index&&wires[a].outGateIndex!=this.index||deleteWire(wires[a]);refreshWires()},this.refreshPosition=function(){this.x=mouseX,this.y=mouseY-mouseY%5,this.left=this.x-22,this.right=this.x+this.length+22,this.up=this.y,this.bottom=this.y+this.height},this.refresh=function(a){if(this.index!=a){var b=this.index;this.index=a,this.name="T_FLIP_FLOP"+this.index;for(var c=0;c<wires.length;c++)wires[c].inGateIndex==b&&(wires[c].inGateIndex=a),wires[c].outGateIndex==b&&(wires[c].outGateIndex=a);for(c=0;c<this.in.length;c++)this.in[c].refresh();for(c=0;c<this.out.length;c++)this.out[c].refresh()}},this.switch=function(a,b){0===this.truthTable[0]&&1===this.truthTable[1]?0===a||1===a&&1===b&&(this.truthTable=[1,0]):1===this.truthTable[0]&&0===this.truthTable[1]&&1===a&&1===b&&(this.truthTable=[0,1])}}function XorGate(a,b){this.x=a,this.y=b,this.index=-1,this.name="XOR_GATE_",this.length=16,this.height=40,this.left=this.x-20,this.right=this.x+1.5*this.length+35,this.up=this.y,this.bottom=this.y+this.height,this.closeButton=new CloseButton,this.inputNum=2,this.outputNum=1,this.in=[],this.out=[],this.isInSignal=!1,this.isOutSignal=!1,this.truthTable=[],this.inputs=[0,0],this.draw=function(){if(noFill(),strokeWeight(2),line(this.x,this.y,this.x+this.length,this.y),line(this.x,this.y+this.height,this.x+this.length,this.y+this.height),arc(this.x-this.length-24,this.y+this.height/2,2*this.height+1,2*this.height-1,-1/3*HALF_PI,1/3*HALF_PI),arc(this.x-this.length-18,this.y+this.height/2,2*this.height+1,2*this.height-1,-1/3*HALF_PI,1/3*HALF_PI),arc(this.x+this.length,this.y+this.height/2,this.length+30,this.height,3*HALF_PI,HALF_PI),2==this.inputNum)line(this.left,this.y+this.height/4,this.x+5,this.y+this.height/4),line(this.left,this.y+3*this.height/4,this.x+5,this.y+3*this.height/4);else for(var a=0;a<this.inputNum;a++)line(this.left,this.y+(a+1)*this.height/(this.inputNum+1),this.x+5,this.y+(a+1)*this.height/(this.inputNum+1));for(a=0;a<this.outputNum;a++)line(this.right-20,this.y+(a+1)*this.height/(this.outputNum+1),this.right,this.y+(a+1)*this.height/(this.outputNum+1));for(strokeWeight(1),this.index>=0&&this.mouseInside()&&null===currentGate&&0===simToggleValue&&null===currentWire?this.closeButton.show():this.closeButton.hide(),a=0;a<this.out.length;a++){var b=this.out[a];mouseX>b.x-10&&mouseX<b.x+10&&mouseY>b.y-10&&mouseY<b.y+10&&0===simToggleValue&&null===currentGate&&0===b.wires.length?b.show():b.hide()}for(a=0;a<this.in.length;a++){var b=this.in[a];mouseX>b.x-10&&mouseX<b.x+10&&mouseY>b.y-10&&mouseY<b.y+10&&0===simToggleValue&&null===currentGate&&0===b.wires.length?b.show():b.hide()}},this.placeTaken=function(a){return a.left<this.right+10&&a.right>this.left-10&&a.up<this.bottom&&a.bottom>this.up},this.clone=function(){return new XorGate},this.mouseInside=function(){return mouseX>this.left-6&&mouseX<this.right+6&&mouseY>this.up&&mouseY<this.bottom},this.set=function(){for(this.refreshPosition(),this.index=gates.length,this.name+=this.index,i=0;i<this.inputNum;i++)this.in[i]=new InButton(this,i);for(i=0;i<this.outputNum;i++)this.out[i]=new OutButton(this,i);this.refreshButtons(),this.truthTable=[[0,1,2],[1,0,2],[2,2,2]]},this.refreshButtons=function(){if(2==this.inputNum)this.in[0].setPosition(this.left,this.y+this.height/4),this.in[1].setPosition(this.left,this.y+3*this.height/4);else for(i=0;i<this.inputNum;i++)this.in[i].setPosition(this.left,this.y+(i+1)*this.height/(this.inputNum+1));for(i=0;i<this.outputNum;i++)this.out[i].setPosition(this.right,this.y+(i+1)*this.height/(this.outputNum+1));this.closeButton.setPosition(this.right-20,this.up)},this.delete=function(){for(var a=0;a<this.inputNum;a++)this.in[a].hide();for(a=0;a<this.outputNum;a++)this.out[a].hide();for(this.closeButton.hide(),a=wires.length-1;a>=0;a--)wires[a].inGateIndex!=this.index&&wires[a].outGateIndex!=this.index||deleteWire(wires[a]);refreshWires()},this.refreshPosition=function(){this.x=mouseX,this.y=mouseY-mouseY%5,this.left=this.x-20,this.right=this.x+1.5*this.length+35,this.up=this.y,this.bottom=this.y+this.height},this.refresh=function(a){if(this.index!=a){var b=this.index;this.index=a,this.name="XOR_GATE_"+this.index;for(var c=0;c<wires.length;c++)wires[c].inGateIndex==b&&(wires[c].inGateIndex=a),wires[c].outGateIndex==b&&(wires[c].outGateIndex=a);for(c=0;c<this.in.length;c++)this.in[c].refresh();for(c=0;c<this.out.length;c++)this.out[c].refresh()}}}function AndGate(a,b){this.x=a,this.y=b,this.index=-1,this.name="AND_GATE_",this.length=20,this.height=40,this.left=this.x-20,this.right=this.x+1.5*this.length+35,this.up=this.y,this.bottom=this.y+this.height,this.closeButton=new CloseButton(this),this.inputNum=2,this.outputNum=1,this.in=[],this.out=[],this.isInSignal=!1,this.isOutSignal=!1,this.truthTable=[],this.inputs=[0,0],this.draw=function(){if(noFill(),strokeWeight(2),line(this.x,this.y,this.x+this.length,this.y),line(this.x,this.y+this.height,this.x+this.length,this.y+this.height),line(this.x,this.y,this.x,this.y+this.height),arc(this.x+this.length,this.y+this.height/2,this.length+15,this.height,3*HALF_PI,HALF_PI),2==this.inputNum)line(this.left,this.y+this.height/4,this.x,this.y+this.height/4),line(this.left,this.y+3*this.height/4,this.x,this.y+3*this.height/4);else for(var a=0;a<this.inputNum;a++)line(this.left,this.y+(a+1)*this.height/(this.inputNum+1),this.x,this.y+(a+1)*this.height/(this.inputNum+1));for(a=0;a<this.outputNum;a++)line(this.right-20,this.y+(a+1)*this.height/(this.outputNum+1),this.right,this.y+(a+1)*this.height/(this.outputNum+1));for(strokeWeight(1),this.index>=0&&this.mouseInside()&&null===currentGate&&0===simToggleValue&&null===currentWire?this.closeButton.show():this.closeButton.hide(),a=0;a<this.out.length;a++){var b=this.out[a];mouseX>b.x-10&&mouseX<b.x+10&&mouseY>b.y-10&&mouseY<b.y+10&&0===simToggleValue&&null===currentGate&&0===b.wires.length?b.show():b.hide()}for(a=0;a<this.in.length;a++){var b=this.in[a];mouseX>b.x-10&&mouseX<b.x+10&&mouseY>b.y-10&&mouseY<b.y+10&&0===simToggleValue&&null===currentGate&&0===b.wires.length?b.show():b.hide()}},this.placeTaken=function(a){return a.left<this.right+10&&a.right>this.left-10&&a.up<this.bottom&&a.bottom>this.up},this.clone=function(){return new AndGate},this.mouseInside=function(){return mouseX>this.left-6&&mouseX<this.right+6&&mouseY>this.up&&mouseY<this.bottom},this.set=function(){for(this.refreshPosition(),this.index=gates.length,this.name+=this.index,i=0;i<this.inputNum;i++)this.in[i]=new InButton(this,i);for(i=0;i<this.outputNum;i++)this.out[i]=new OutButton(this,i);this.refreshButtons(),this.truthTable=[[0,0,0],[0,1,2],[0,2,2]]},this.refreshButtons=function(){if(2==this.inputNum)this.in[0].setPosition(this.left,this.y+this.height/4),this.in[1].setPosition(this.left,this.y+3*this.height/4);else for(i=0;i<this.inputNum;i++)this.in[i].setPosition(this.left,this.y+(i+1)*this.height/(this.inputNum+1));for(i=0;i<this.outputNum;i++)this.out[i].setPosition(this.right,this.y+(i+1)*this.height/(this.outputNum+1));this.closeButton.setPosition(this.right-20,this.up)},this.delete=function(){for(var a=0;a<this.inputNum;a++)this.in[a].hide();for(a=0;a<this.outputNum;a++)this.out[a].hide();for(this.closeButton.hide(),a=wires.length-1;a>=0;a--)wires[a].inGateIndex!=this.index&&wires[a].outGateIndex!=this.index||deleteWire(wires[a]);refreshWires()},this.refreshPosition=function(){this.x=mouseX,this.y=mouseY-mouseY%5,this.left=this.x-20,this.right=this.x+1.5*this.length+28,this.up=this.y,this.bottom=this.y+this.height},this.refresh=function(a){if(this.index!=a){var b=this.index;this.index=a,this.name="AND_GATE_"+this.index;for(var c=0;c<wires.length;c++)wires[c].inGateIndex==b&&(wires[c].inGateIndex=a),wires[c].outGateIndex==b&&(wires[c].outGateIndex=a);for(c=0;c<this.in.length;c++)this.in[c].refresh();for(c=0;c<this.out.length;c++)this.out[c].refresh()}}}function BcdToSevenSeg(a,b){this.x=a,this.y=b,this.index=-1,this.name="BCD_TO_SEVEN_SEG_",this.length=55,this.height=110,this.left=this.x-10,this.right=this.x+this.length+10,this.up=this.y,this.bottom=this.y+this.height,this.closeButton=new CloseButton(this),this.inputNum=4,this.outputNum=7,this.in=[],this.out=[],this.isInSignal=!1,this.isOutSignal=!1,this.truthTable=[],this.inputs=[0,0,0,0],this.draw=function(){noFill(),strokeWeight(2),line(this.x,this.y,this.x+this.length,this.y),line(this.x,this.y+this.height,this.x+this.length,this.y+this.height),line(this.x,this.y,this.x,this.y+this.height),line(this.x+this.length,this.y,this.x+this.length,this.y+this.height);for(var a=0;a<this.inputNum;a++)line(this.left,this.y+25+20*a,this.x,this.y+25+20*a);for(var a=0;a<this.outputNum;a++)line(this.x+this.length,this.y+10+15*a,this.right,this.y+10+15*a);for(strokeWeight(.7),textSize(9),text("A",this.x-10,this.y+23),text("B",this.x-10,this.y+43),text("C",this.x-10,this.y+63),text("D",this.x-10,this.y+83),text("A",this.right-15,this.y+8),text("B",this.right-15,this.y+23),text("C",this.right-15,this.y+38),text("D",this.right-15,this.y+53),text("E",this.right-15,this.y+68),text("F",this.right-15,this.y+83),text("G",this.right-15,this.y+98),strokeWeight(1),textSize(12),text("BCD\n   to\n7seg",this.x+15,this.y+42),strokeWeight(1),this.index>=0&&this.mouseInside()&&null===currentGate&&0===simToggleValue&&null===currentWire?this.closeButton.show():this.closeButton.hide(),a=0;a<this.out.length;a++){var b=this.out[a];mouseX>b.x-6&&mouseX<b.x+6&&mouseY>b.y-6&&mouseY<b.y+6&&0===simToggleValue&&null===currentGate&&0===b.wires.length?b.show():b.hide()}for(a=0;a<this.in.length;a++){var b=this.in[a];mouseX>b.x-10&&mouseX<b.x+10&&mouseY>b.y-10&&mouseY<b.y+10&&0===simToggleValue&&null===currentGate&&0===b.wires.length?b.show():b.hide()}},this.placeTaken=function(a){return a.left<this.right+10&&a.right>this.left-10&&a.up<this.bottom&&a.bottom>this.up},this.clone=function(){return new BcdToSevenSeg},this.mouseInside=function(){return mouseX>this.left-5&&mouseX<this.right+5&&mouseY>this.up&&mouseY<this.bottom},this.set=function(){this.refreshPosition(),this.index=gates.length,this.name+=this.index;for(var a=0;a<this.inputNum;a++)this.in[a]=new InButton(this,a),this.in[a].setPosition(this.left,this.y+25+20*a);for(a=0;a<this.outputNum;a++)this.out[a]=new OutButton(this,a),this.out[a].setPosition(this.right,this.y+10+15*a);this.refreshButtons(),this.truthTable=[[[[[1,1,1,1,1,1,0],[0,1,1,0,0,0,0]],[[1,1,0,1,1,0,1],[1,1,1,1,0,0,1]]],[[[0,1,1,0,0,1,1],[1,0,1,1,0,1,1]],[[1,0,1,1,1,1,1],[1,1,1,0,0,0,0]]]],[[[[1,1,1,1,1,1,1],[1,1,1,1,0,1,1]],[[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]]],[[[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]],[[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]]]]]},this.refreshButtons=function(){for(var a=0;a<this.inputNum;a++)this.in[a].setPosition(this.left,this.y+25+20*a);for(a=0;a<this.outputNum;a++)this.out[a].setPosition(this.right,this.y+10+15*a);this.closeButton.setPosition(this.right-33,this.up+2)},this.delete=function(){for(var a=0;a<this.inputNum;a++)this.in[a].hide();for(this.closeButton.hide(),a=wires.length-1;a>=0;a--)wires[a].inGateIndex!=this.index&&wires[a].outGateIndex!=this.index||deleteWire(wires[a]);refreshWires()},this.refreshPosition=function(){this.x=mouseX,this.y=mouseY-mouseY%5,this.left=this.x-20,this.right=this.x+this.length+20,this.up=this.y,this.bottom=this.y+this.height},this.refresh=function(a){if(this.index!=a){var b=this.index;this.index=a,this.name="BCD_TO_SEVEN_SEG_"+this.index;for(var c=0;c<wires.length;c++)wires[c].inGateIndex==b&&(wires[c].inGateIndex=a),wires[c].outGateIndex==b&&(wires[c].outGateIndex=a);for(c=0;c<this.in.length;c++)this.in[c].refresh();for(c=0;c<this.out.length;c++)this.out[c].refresh()}}}function Clock(a,b){this.x=a,this.y=b,this.index=-1,this.name="CLOCK_",this.length=40,this.height=40,this.left=this.x,this.right=this.x+this.length+20,this.up=this.y,this.bottom=this.y+this.height,this.closeButton=new CloseButton(this),this.statusButton,this.inputNum=0,this.outputNum=1,this.in=[],this.out=[],this.isInSignal=!0,this.isOutSignal=!1,this.truthTable=[],this.status=0,this.counter=0,this.speed=1,this.isClock=!0,this.inputs=[],this.draw=function(){noFill(),strokeWeight(2),line(this.x,this.y,this.x+this.length,this.y),line(this.x,this.y+this.height,this.x+this.length,this.y+this.height),line(this.x,this.y,this.x,this.y+this.height),line(this.x+this.length,this.y,this.x+this.length,this.y+this.height);var a=3,b=-10;for(line(this.x+4+a,this.y+25+b,this.x+12+a,this.y+25+b),line(this.x+12+a,this.y+25+b,this.x+12+a,this.y+15+b),line(this.x+13+a,this.y+15+b,this.x+21+a,this.y+15+b),line(this.x+21+a,this.y+15+b,this.x+21+a,this.y+25+b),line(this.x+22+a,this.y+25+b,this.x+29+a,this.y+25+b),line(this.x+this.length,this.y+this.height/2,this.x+this.length+20,this.y+this.height/2),strokeWeight(1),this.index>=0&&this.mouseInside()&&null===currentGate&&0===simToggleValue&&null===currentWire?this.closeButton.show():this.closeButton.hide(),i=0;i<this.out.length;i++){var c=this.out[i];mouseX>c.x-10&&mouseX<c.x+10&&mouseY>c.y-10&&mouseY<c.y+10&&0===simToggleValue&&null===currentGate&&0===c.wires.length?c.show():c.hide()}},this.placeTaken=function(a){return a.left<this.right+10&&a.right>this.left-10&&a.up<this.bottom&&a.bottom>this.up},this.clone=function(){return new Clock},this.mouseInside=function(){return mouseX>this.left-6&&mouseX<this.right+6&&mouseY>this.up&&mouseY<this.bottom},this.set=function(){for(this.refreshPosition(),this.index=gates.length,this.name+=this.index,i=0;i<this.outputNum;i++)this.out[i]=new OutButton(this,i);this.out[0].setPosition(this.right,this.y+this.height/2),this.closeButton.setPosition(this.right-33,this.up+2),this.statusButton=new StatusButton(this,this.index),this.statusButton.button.style("background","#ccddff"),this.refreshButtons()},this.refreshButtons=function(){this.out[0].setPosition(this.right,this.up+this.height/2),this.statusButton.setPosition(this.x+10,this.bottom-22),this.closeButton.setPosition(this.right-15,this.up-3)},this.delete=function(){for(var a=0;a<this.inputNum;a++)this.in[a].hide();for(a=0;a<this.outputNum;a++)this.out[a].hide();for(this.closeButton.hide(),this.statusButton.hide(),a=wires.length-1;a>=0;a--)wires[a].inGateIndex!=this.index&&wires[a].outGateIndex!=this.index||deleteWire(wires[a]);refreshWires()},this.refreshPosition=function(){this.x=mouseX,this.y=mouseY-mouseY%5,this.left=this.x,this.right=this.x+this.length+22,this.up=this.y,this.bottom=this.y+this.height},this.refresh=function(a){if(this.index!=a){var b=this.index;this.index=a,this.name="CLOCK_"+this.index;for(var c=0;c<wires.length;c++)wires[c].inGateIndex==b&&(wires[c].inGateIndex=a),wires[c].outGateIndex==b&&(wires[c].outGateIndex=a);for(c=0;c<this.in.length;c++)this.in[c].refresh();for(c=0;c<this.out.length;c++)this.out[c].refresh();this.statusButton.refresh()}},this.switch=function(){return++this.counter%this.speed==0&&(this.counter=0,this.status^=1,!0)},this.switchSpeed=function(){switch(this.speed){case 100:this.speed=0,this.statusButton.button.style("background","#ffffff");break;case 0:this.speed=1,this.statusButton.button.style("background","#ccddff");break;case 1:this.speed=10,this.statusButton.button.style("background","#a5c4ff");break;case 10:this.speed=25,this.statusButton.button.style("background","#689cff");break;case 25:this.speed=100,this.statusButton.button.style("background","#236fff")}console.log("switch speed "+this.speed)}}function Counter(a,b){this.x=a,this.y=b,this.index=-1,this.name="COUNTER_",this.length=46,this.height=80,this.left=this.x-10,this.right=this.x+this.length+10,this.up=this.y,this.bottom=this.y+this.height,this.closeButton=new CloseButton(this),this.inputNum=2,this.outputNum=4,this.in=[],this.out=[],this.isInSignal=!1,this.isOutSignal=!1,this.truthTable=[0,0,0,0,0,0],this.state=0,this.counter=!0,this.previousClk=0,this.previousReset=0,this.inputs=[0,0],this.draw=function(){noFill(),strokeWeight(2),line(this.x,this.y,this.x+this.length,this.y),line(this.x,this.y+this.height,this.x+this.length,this.y+this.height),line(this.x,this.y,this.x,this.y+this.height),line(this.x+this.length,this.y,this.x+this.length,this.y+this.height),line(this.left,this.y+20,this.x,this.y+20),line(this.left,this.y+60,this.x,this.y+60);for(var a=0;a<this.outputNum;a++)line(this.x+this.length,this.y+10+20*a,this.right,this.y+10+20*a);for(strokeWeight(.7),textSize(9),text("C",this.x-10,this.y+18),text("R",this.x-10,this.y+58),text("A",this.right-15,this.y+8),text("B",this.right-15,this.y+28),text("C",this.right-15,this.y+48),text("D",this.right-15,this.y+68),strokeWeight(1),textSize(12),text("CNTR",this.x+6,this.y+42),strokeWeight(1),this.index>=0&&this.mouseInside()&&null===currentGate&&0===simToggleValue&&null===currentWire?this.closeButton.show():this.closeButton.hide(),a=0;a<this.out.length;a++){var b=this.out[a];mouseX>b.x-10&&mouseX<b.x+10&&mouseY>b.y-10&&mouseY<b.y+10&&0===simToggleValue&&null===currentGate&&0===b.wires.length?b.show():b.hide()}for(a=0;a<this.in.length;a++){var b=this.in[a];mouseX>b.x-10&&mouseX<b.x+10&&mouseY>b.y-10&&mouseY<b.y+10&&0===simToggleValue&&null===currentGate&&0===b.wires.length?b.show():b.hide()}},this.placeTaken=function(a){return a.left<this.right&&a.right>this.left&&a.up<this.bottom&&a.bottom>this.up},this.clone=function(){return new Counter},this.mouseInside=function(){return mouseX>this.left-6&&mouseX<this.right+6&&mouseY>this.up&&mouseY<this.bottom},this.set=function(){this.refreshPosition(),this.index=gates.length,this.name+=this.index;for(var a=0;a<this.inputNum;a++)this.in[a]=new InButton(this,a);for(a=0;a<this.outputNum;a++)this.out[a]=new OutButton(this,a);this.refreshButtons()},this.refreshButtons=function(){for(this.in[0].setPosition(this.left,this.y+20),this.in[1].setPosition(this.left,this.y+60),i=0;i<this.outputNum;i++)this.out[i].setPosition(this.right,this.y+20*i+10);this.closeButton.setPosition(this.right-33,this.up+2)},this.delete=function(){for(var a=0;a<this.inputNum;a++)this.in[a].hide();for(this.closeButton.hide(),a=wires.length-1;a>=0;a--)wires[a].inGateIndex!=this.index&&wires[a].outGateIndex!=this.index||deleteWire(wires[a]);refreshWires()},this.refreshPosition=function(){this.x=mouseX,this.y=mouseY-mouseY%5,this.left=this.x-20,this.right=this.x+this.length+20,this.up=this.y,this.bottom=this.y+this.height},this.refresh=function(a){if(this.index!=a){var b=this.index;this.index=a,this.name="COUNTER_"+this.index;for(var c=0;c<wires.length;c++)wires[c].inGateIndex==b&&(wires[c].inGateIndex=a),wires[c].outGateIndex==b&&(wires[c].outGateIndex=a);for(c=0;c<this.in.length;c++)this.in[c].refresh();for(c=0;c<this.out.length;c++)this.out[c].refresh()}},this.reset=function(){this.inputs=[0,1],this.switch(),this.inputs=[0,0],this.switch()},this.switch=function(){switch(clk=inputs[0],reset=inputs[1],1===clk&&this.previousClk!=clk&&(this.state++,this.state%=16),"undefined"==typeof reset||2===reset?this.previousReset=0:1===reset&&(this.state=0),this.previousClk=clk,this.previousReset=reset,this.state){case 0:this.truthTable=[0,0,0,0];break;case 1:this.truthTable=[0,0,0,1];break;case 2:this.truthTable=[0,0,1,0];break;case 3:this.truthTable=[0,0,1,1];break;case 4:this.truthTable=[0,1,0,0];break;case 5:this.truthTable=[0,1,0,1];break;case 6:this.truthTable=[0,1,1,0];break;case 7:this.truthTable=[0,1,1,1];break;case 8:this.truthTable=[1,0,0,0];break;case 9:this.truthTable=[1,0,0,1];break;case 10:this.truthTable=[1,0,1,0];break;case 11:this.truthTable=[1,0,1,1];break;case 12:this.truthTable=[1,1,0,0];break;case 13:this.truthTable=[1,1,0,1];break;case 14:this.truthTable=[1,1,1,0];break;case 15:this.truthTable=[1,1,1,1]}}}function OutButton(a,b){this.gate=a,this.gateIndex=this.gate.index,this.outIndex=b,this.wires=[],this.x,this.y,this.button=createButton(""),this.button.addClass("sigButton"),this.button.value(this.gateIndex),this.button.id(this.outIndex),this.button.mousePressed(function(){if(1!==simToggleValue&&1!==deleteWireMode)if(null===currentWire){currentWire=new Wire,currentWire.addOut(this.value(),this.id());var a=gates[this.value()].out[parseInt(this.id())];a.wires.push(currentWire)}else{if(null!==currentWire.outGateIndex)return void print("Ne ide");currentWire.addOut(this.value(),this.id());for(var b=[],c=0;c<currentWire.points.length;c++)b.push(currentWire.points[c]);var d=b.length-1;for(c=0;c<b.length;c++)currentWire.points[c]=b[d--];var a=gates[this.value()].out[parseInt(this.id())];a.wires.push(currentWire),currentWire.push()}}),this.setPosition=function(a,b){this.x=a,this.y=b;var c=document.getElementById("canvas-holder"),d=c.getBoundingClientRect();this.button.position(d.left+this.x-7,d.top+this.y-7+scroll)},this.hide=function(){this.button.style("visibility","hidden")},this.show=function(){this.button.style("visibility","visible")},this.refresh=function(){this.gateIndex=this.gate.index,this.button.value(this.gateIndex)}}function StatusButton(a,b){this.inSignal=a,this.inSignalIndex=b,this.x,this.y,this.button=createButton(""),this.button.addClass("statButton"),this.button.value(this.inSignalIndex),this.button.mousePressed(function(){void 0!==gates[this.value()].isClock&&gates[this.value()].isClock?gates[this.value()].switchSpeed():(gates[this.value()].switch(),1===simToggleValue&&simulate(!1,gates[this.value()]))}),this.setPosition=function(a,b){this.x=a,this.y=b;var c=document.getElementById("canvas-holder"),d=c.getBoundingClientRect();this.button.position(d.left+this.x+2,d.top+this.y+scroll+2)},this.hide=function(){this.button.style("visibility","hidden")},this.show=function(){this.button.style("visibility","visible")},this.refresh=function(){this.inSignalIndex=this.inSignal.index,this.button.value(this.inSignalIndex)}}function BranchButton(a){this.wire=a,this.button=createButton(""),this.button.addClass("branchButton"),this.button.style("visibility","hidden"),this.x,this.y,this.pointBeforeIndex,this.button.mousePressed(function(){if(0===deleteWireMode){if(null===currentWire){currentWire=new Wire;var a=this.value();currentWire.outGateIndex=wires[a].outGateIndex,currentWire.outIndex=wires[a].outIndex;var b=gates[wires[a].outGateIndex].out[wires[a].outIndex];b.wires.push(currentWire);var c=wires[a].branchButton,d=c.pointBeforeIndex,e=c.wire.points;currentWire.branchedFrom=a;for(var a=0;a<=d;a++)currentWire.points.push(e[a]);return currentWire.points.push(new Point(c.x,c.y)),currentWire.branchingPoint=new Point(c.x,c.y),void(currentWire.branchIndexBefore=c.pointBeforeIndex)}if(null!==currentWire.outGateIndex)return;a=this.value(),currentWire.outGateIndex=wires[a].outGateIndex,currentWire.outIndex=wires[a].outIndex;var b=gates[wires[a].outGateIndex].out[wires[a].outIndex];if(b.wires.push(currentWire),c=wires[a].branchButton,d=c.pointBeforeIndex,e=c.wire.points,currentWire.addPath(),currentWire.points.splice(currentWire.points.length-1,1),e[d].y==e[d+1].y){currentWire.points.splice(currentWire.points.length-1,1),currentWire.points.push(new Point(currentWire.points[currentWire.points.length-1].x,c.y)),currentWire.branchingPoint=new Point(currentWire.points[currentWire.points.length-1].x,c.y);var f=e[d].x,g=e[d+1].x,h=currentWire.points[currentWire.points.length-1].x;h<min(f,g)?currentWire.branchingPoint.x=min(f,g):h>max(f,g)?currentWire.branchingPoint.x=max(f,g):currentWire.branchingPoint.x=h,currentWire.points.push(new Point(c.x,c.y))}else currentWire.points.push(new Point(c.x,c.y)),currentWire.branchingPoint=new Point(c.x,c.y);for(p=d;p>=0;p--)currentWire.points.push(e[p]);for(e=[],a=0;a<currentWire.points.length;a++)e.push(currentWire.points[a]);for(p=e.length-1,a=0;a<e.length;a++)currentWire.points[a]=e[p--];currentWire.push()}else{var a=this.value(),i=wires[a],j=[],k=i.branchButton,l=i.points[k.pointBeforeIndex],m=i.points[k.pointBeforeIndex+1],n=!0;l.x===m.x&&(n=!1);for(var a=0;a<wires.length;a++){var o=wires[a];if(o.outGateIndex===i.outGateIndex)for(var p=1;p<o.points.length;p++){var q=o.points[p-1],r=o.points[p];q.y===r.y===n&&(n?k.y===q.y&&k.x>min(q.x,r.x)&&k.x<max(q.x,r.x)&&j.push(o):k.x===q.x&&k.y>min(q.y,r.y)&&k.y<max(q.y,r.y)&&j.push(o))}}for(var a=j.length-1;a>=0;a--)j[a].branchButton.hide(),deleteWire(j[a]),refreshWires();k.hide()}}),this.setIndex=function(){this.button.value(this.wire.index)},this.setPointBeforeIndex=function(a){this.pointBeforeIndex=a},this.setPosition=function(a,b){this.x=a,this.y=b;var c=document.getElementById("canvas-holder"),d=c.getBoundingClientRect();this.button.position(d.left+this.x-7,d.top+this.y-7+scroll)},this.hide=function(){this.button.style("visibility","hidden")},this.show=function(){this.button.style("visibility","visible")}}function CloseButton(a){this.button=createButton("X"),this.button.addClass("closeButton"),this.button.value(1),this.gate=a,this.button.mousePressed(function(){this.value(-1)}),this.setPosition=function(a,b){var c=document.getElementById("canvas-holder"),d=c.getBoundingClientRect();this.button.position(a+d.left,b+d.top+scroll)},this.hide=function(){this.button.style("visibility","hidden")},this.show=function(){this.button.style("visibility","visible")},this.value=function(){return this.button.value()}}function InButton(a,b){this.gate=a,this.gateIndex=this.gate.index,this.inIndex=b,this.wires=[],this.x,this.y,this.button=createButton(""),this.button.addClass("sigButton"),this.button.value(this.gateIndex),this.button.id(this.inIndex),this.button.mousePressed(function(){var a=gates[this.value()].in[parseInt(this.id())];if(print(a),1!==simToggleValue&&1!==deleteWireMode)if(null===currentWire&&0===a.wires.length)currentWire=new Wire,currentWire.addIn(this.value(),this.id()),a.wires.push(currentWire);else{if(null!==currentWire.inGateIndex||1===a.wires.length)return;currentWire.addIn(this.value(),this.id());var a=gates[this.value()].in[parseInt(this.id())];a.wires.push(currentWire),currentWire.push()}}),this.setPosition=function(a,b){this.x=a,this.y=b;var c=document.getElementById("canvas-holder"),d=c.getBoundingClientRect();this.button.position(d.left+this.x-7,d.top+this.y-7+scroll)},this.hide=function(){this.button.style("visibility","hidden")},this.show=function(){this.button.style("visibility","visible")},this.refresh=function(){this.gateIndex=this.gate.index,this.button.value(this.gateIndex)}}var inputQueue=[],inputQueueFlags={},clockInputQueue=[],clockInputQueueFlags={},inputGates=[],clockInputGates=[],clocks=[],gates=[],wires=[],currentGate=null,currentWire=null,canvas,simToggleValue=0,deleteWireMode=0,canWidth,canHeigth,scroll=$(document).scrollTop(),intervalClock,gateCreated=!1;